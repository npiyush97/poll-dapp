var $t=Object.defineProperty;var ht=Object.getOwnPropertySymbols;var Tt=Object.prototype.hasOwnProperty,Et=Object.prototype.propertyIsEnumerable;var pt=(g,n,T)=>n in g?$t(g,n,{enumerable:!0,configurable:!0,writable:!0,value:T}):g[n]=T,q=(g,n)=>{for(var T in n||(n={}))Tt.call(n,T)&&pt(g,T,n[T]);if(ht)for(var T of ht(n))Et.call(n,T)&&pt(g,T,n[T]);return g};function R(){}const Ot=g=>g;function yt(g,n){for(const T in n)g[T]=n[T];return g}function dt(g){return g()}function vt(){return Object.create(null)}function z(g){g.forEach(dt)}function Dt(g){return typeof g=="function"}function Bt(g,n){return g!=g?n==n:g!==n||g&&typeof g=="object"||typeof g=="function"}function Nt(g){return Object.keys(g).length===0}function Gt(g,...n){if(g==null)return R;const T=g.subscribe(...n);return T.unsubscribe?()=>T.unsubscribe():T}function ee(g,n,T){g.$$.on_destroy.push(Gt(n,T))}function ne(g){const n={};for(const T in g)T[0]!=="$"&&(n[T]=g[T]);return n}function re(g,n,T=n){return g.set(T),n}const wt=typeof window!="undefined";let Ct=wt?()=>window.performance.now():()=>Date.now(),bt=wt?g=>requestAnimationFrame(g):R;const W=new Set;function gt(g){W.forEach(n=>{n.c(g)||(W.delete(n),n.f())}),W.size!==0&&bt(gt)}function It(g){let n;return W.size===0&&bt(gt),{promise:new Promise(T=>{W.add(n={c:g,f:T})}),abort(){W.delete(n)}}}let X=!1;function Pt(){X=!0}function Ut(){X=!1}function Jt(g,n,T,m){for(;g<n;){const t=g+(n-g>>1);T(t)<=m?g=t+1:n=t}return g}function Mt(g){if(g.hydrate_init)return;g.hydrate_init=!0;const n=g.childNodes,T=new Int32Array(n.length+1),m=new Int32Array(n.length);T[0]=-1;let t=0;for(let f=0;f<n.length;f++){const r=n[f].claim_order,h=Jt(1,t+1,v=>n[T[v]].claim_order,r)-1;m[f]=T[h]+1;const l=h+1;T[l]=f,t=Math.max(l,t)}const i=[],e=[];let s=n.length-1;for(let f=T[t]+1;f!=0;f=m[f-1]){for(i.push(n[f-1]);s>=f;s--)e.push(n[s]);s--}for(;s>=0;s--)e.push(n[s]);i.reverse(),e.sort((f,r)=>f.claim_order-r.claim_order);for(let f=0,r=0;f<e.length;f++){for(;r<i.length&&e[f].claim_order>=i[r].claim_order;)r++;const h=r<i.length?i[r]:null;g.insertBefore(e[f],h)}}function Kt(g,n){X?(Mt(g),(g.actual_end_child===void 0||g.actual_end_child!==null&&g.actual_end_child.parentElement!==g)&&(g.actual_end_child=g.firstChild),n!==g.actual_end_child?g.insertBefore(n,g.actual_end_child):g.actual_end_child=n.nextSibling):n.parentNode!==g&&g.appendChild(n)}function ie(g,n,T){X&&!T?Kt(g,n):(n.parentNode!==g||n.nextSibling!=T)&&g.insertBefore(n,T||null)}function Ht(g){g.parentNode.removeChild(g)}function oe(g,n){for(let T=0;T<g.length;T+=1)g[T]&&g[T].d(n)}function ue(g){return document.createElement(g)}function ae(g){return document.createElementNS("http://www.w3.org/2000/svg",g)}function _t(g){return document.createTextNode(g)}function fe(){return _t(" ")}function se(){return _t("")}function ce(g,n,T,m){return g.addEventListener(n,T,m),()=>g.removeEventListener(n,T,m)}function le(g){return function(n){return n.preventDefault(),g.call(this,n)}}function he(g,n,T){T==null?g.removeAttribute(n):g.getAttribute(n)!==T&&g.setAttribute(n,T)}function Rt(g){return Array.from(g.childNodes)}function pe(g,n){n=""+n,g.wholeText!==n&&(g.data=n)}function ye(g,n){g.value=n==null?"":n}function de(g,n,T,m){g.style.setProperty(n,T,m?"important":"")}function ve(g,n,T){g.classList[T?"add":"remove"](n)}function Ft(g,n,T=!1){const m=document.createEvent("CustomEvent");return m.initCustomEvent(g,T,!1,n),m}let Z;function tt(g){Z=g}function mt(){if(!Z)throw new Error("Function called outside component initialization");return Z}function we(g){mt().$$.on_mount.push(g)}function be(){const g=mt();return(n,T)=>{const m=g.$$.callbacks[n];if(m){const t=Ft(n,T);m.slice().forEach(i=>{i.call(g,t)})}}}const V=[],kt=[],et=[],rt=[],qt=Promise.resolve();let it=!1;function Wt(){it||(it=!0,qt.then(St))}function ot(g){et.push(g)}function ge(g){rt.push(g)}let ut=!1;const at=new Set;function St(){if(!ut){ut=!0;do{for(let g=0;g<V.length;g+=1){const n=V[g];tt(n),Lt(n.$$)}for(tt(null),V.length=0;kt.length;)kt.pop()();for(let g=0;g<et.length;g+=1){const n=et[g];at.has(n)||(at.add(n),n())}et.length=0}while(V.length);for(;rt.length;)rt.pop()();it=!1,ut=!1,at.clear()}}function Lt(g){if(g.fragment!==null){g.update(),z(g.before_update);const n=g.dirty;g.dirty=[-1],g.fragment&&g.fragment.p(g.ctx,n),g.after_update.forEach(ot)}}const nt=new Set;let F;function _e(){F={r:0,c:[],p:F}}function me(){F.r||z(F.c),F=F.p}function zt(g,n){g&&g.i&&(nt.delete(g),g.i(n))}function ke(g,n,T,m){if(g&&g.o){if(nt.has(g))return;nt.add(g),F.c.push(()=>{nt.delete(g),m&&(T&&g.d(1),m())}),g.o(n)}}function Se(g,n,T){const m=g.$$.props[n];m!==void 0&&(g.$$.bound[m]=T,T(g.$$.ctx[m]))}function xe(g){g&&g.c()}function Vt(g,n,T,m){const{fragment:t,on_mount:i,on_destroy:e,after_update:s}=g.$$;t&&t.m(n,T),m||ot(()=>{const f=i.map(dt).filter(Dt);e?e.push(...f):z(f),g.$$.on_mount=[]}),s.forEach(ot)}function Yt(g,n){const T=g.$$;T.fragment!==null&&(z(T.on_destroy),T.fragment&&T.fragment.d(n),T.on_destroy=T.fragment=null,T.ctx=[])}function Qt(g,n){g.$$.dirty[0]===-1&&(V.push(g),Wt(),g.$$.dirty.fill(0)),g.$$.dirty[n/31|0]|=1<<n%31}function Ae(g,n,T,m,t,i,e=[-1]){const s=Z;tt(g);const f=g.$$={fragment:null,ctx:null,props:i,update:R,not_equal:t,bound:vt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(s?s.$$.context:n.context||[]),callbacks:vt(),dirty:e,skip_bound:!1};let r=!1;if(f.ctx=T?T(g,n.props||{},(h,l,...v)=>{const d=v.length?v[0]:l;return f.ctx&&t(f.ctx[h],f.ctx[h]=d)&&(!f.skip_bound&&f.bound[h]&&f.bound[h](d),r&&Qt(g,h)),l}):[],f.update(),r=!0,z(f.before_update),f.fragment=m?m(f.ctx):!1,n.target){if(n.hydrate){Pt();const h=Rt(n.target);f.fragment&&f.fragment.l(h),h.forEach(Ht)}else f.fragment&&f.fragment.c();n.intro&&zt(g.$$.fragment),Vt(g,n.target,n.anchor,n.customElement),Ut(),St()}tt(s)}class je{$destroy(){Yt(this,1),this.$destroy=R}$on(n,T){const m=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return m.push(T),()=>{const t=m.indexOf(T);t!==-1&&m.splice(t,1)}}$set(n){this.$$set&&!Nt(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}const L=[];function Xt(g,n=R){let T;const m=[];function t(s){if(Bt(g,s)&&(g=s,T)){const f=!L.length;for(let r=0;r<m.length;r+=1){const h=m[r];h[1](),L.push(h,g)}if(f){for(let r=0;r<L.length;r+=2)L[r][0](L[r+1]);L.length=0}}}function i(s){t(s(g))}function e(s,f=R){const r=[s,f];return m.push(r),m.length===1&&(T=n(t)||R),s(g),()=>{const h=m.indexOf(r);h!==-1&&m.splice(h,1),m.length===0&&(T(),T=null)}}return{set:t,update:i,subscribe:e}}function $e(g){return-.5*(Math.cos(Math.PI*g)-1)}function xt(g){return Object.prototype.toString.call(g)==="[object Date]"}function ft(g,n){if(g===n||g!==g)return()=>g;const T=typeof g;if(T!==typeof n||Array.isArray(g)!==Array.isArray(n))throw new Error("Cannot interpolate values of different type");if(Array.isArray(g)){const m=n.map((t,i)=>ft(g[i],t));return t=>m.map(i=>i(t))}if(T==="object"){if(!g||!n)throw new Error("Object cannot be null");if(xt(g)&&xt(n)){g=g.getTime(),n=n.getTime();const i=n-g;return e=>new Date(g+e*i)}const m=Object.keys(n),t={};return m.forEach(i=>{t[i]=ft(g[i],n[i])}),i=>{const e={};return m.forEach(s=>{e[s]=t[s](i)}),e}}if(T==="number"){const m=n-g;return t=>g+t*m}throw new Error(`Cannot interpolate ${T} values`)}function Te(g,n={}){const T=Xt(g);let m,t=g;function i(e,s){if(g==null)return T.set(g=e),Promise.resolve();t=e;let f=m,r=!1,{delay:h=0,duration:l=400,easing:v=Ot,interpolate:d=ft}=yt(yt({},n),s);if(l===0)return f&&(f.abort(),f=null),T.set(g=t),Promise.resolve();const y=Ct()+h;let u;return m=It(_=>{if(_<y)return!0;r||(u=d(g,e),typeof l=="function"&&(l=l(g,e)),r=!0),f&&(f.abort(),f=null);const x=_-y;return x>l?(T.set(g=e),!1):(T.set(g=u(v(x/l))),!0)}),m.promise}return{set:i,update:(e,s)=>i(e(t,g),s),subscribe:T.subscribe}}var st=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function At(g){throw new Error('Could not dynamically require "'+g+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var jt={exports:{}};(function(g){(function(){function n(m,t){return t?At(m):m.slice?n[i(m)]:function(e,s){m(e={exports:{}}),n[i(s)]=e.exports};function i(e){return e.split("/").slice(-1).toString().replace(".js","")}}var T=g;n(function(m){String.random=function(i,e){var s="";for(i=i||24,e=e||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";i-- >0;)s+=e.charAt(Math.floor(Math.random()*e.length));return s},String.match=function(i,e){var s,f;return typeof i!="string"?!1:(typeof e=="string"&&(e={"=":e}),e=e||{},s=e["="]||e["*"]||e[">"]||e["<"],i===s?!0:f!==e["="]?!1:(s=e["*"]||e[">"],i.slice(0,(s||"").length)===s?!0:f!==e["*"]?!1:f!==e[">"]&&f!==e["<"]?i>=e[">"]&&i<=e["<"]:f!==e[">"]&&i>=e[">"]||f!==e["<"]&&i<=e["<"]))},String.hash=function(i,e){if(typeof i=="string"){if(e=e||0,!i.length)return e;for(var s=0,f=i.length,r;s<f;++s)r=i.charCodeAt(s),e=(e<<5)-e+r,e|=0;return e}};var t=Object.prototype.hasOwnProperty;Object.plain=function(i){return i?i instanceof Object&&i.constructor===Object||Object.prototype.toString.call(i).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(i,e){for(var s in i)if(t.call(i,s)&&(!e||e.indexOf(s)==-1))return!1;return!0},Object.keys=Object.keys||function(i){var e=[];for(var s in i)t.call(i,s)&&e.push(s);return e},function(){var i,e=setTimeout,s=0,f=0,r=typeof setImmediate!=""+i&&setImmediate||e;e.poll=e.poll||function(h){if(1>=+new Date-s&&f++<3333){h();return}r(function(){s=+new Date,h()},f=0)}}(),function(){var i=setTimeout,e=i.turn=i.turn||function(v){s.push(v)==1&&f(l)},s=e.s=[],f=i.poll,r=0,h,l=function(){(h=s[r++])&&h(),(r==s.length||r==99)&&(s=e.s=s.slice(r),r=0),s.length&&f(l)}}(),function(){var i,e=setTimeout,s=e.turn;(e.each=e.each||function(f,r,h,l){l=l||9,function v(d,y,u){if(y=(d=(f||[]).splice(0,l)).length){for(var _=0;_<y&&i===(u=r(d[_]));_++);if(i===u){s(v);return}}h&&h(u)}()})()}()})(n,"./shim"),n(function(m){m.exports=function t(i,e,s){if(!i)return{to:t};var f,r=typeof e=="function",i=(this.tag||(this.tag={}))[i]||r&&(this.tag[i]={tag:i,to:t._={next:function(l){var v;(v=this.to)&&v.next(l)}}});if(r){var h={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:e,the:i,on:this,as:s};return(h.back=i.last||i).to=h,i.last=h}return(i=i.to)&&f!==e&&i.next(e),i}})(n,"./onto"),n(function(m){n("./shim"),m.exports=function(t){return t===void 0?!1:t===null?!0:t===1/0||t!==t?!1:typeof t=="string"||typeof t=="boolean"||typeof t=="number"?!0:t&&typeof(t["#"]||0)=="string"&&Object.empty(t,["#"])?t["#"]:!1}})(n,"./valid"),n(function(m){n("./shim");function t(){var h=+new Date;return f<h?(e=0,f=h+t.drift):f=h+(e+=1)/s+t.drift}t.drift=0;var i=-1/0,e=0,s=999,f=i,r;t.is=function(h,l,v){var d=l&&h&&h._&&h._[">"]||v;if(!!d)return typeof(d=d[l])=="number"?d:i},t.ify=function(h,l,v,d,y){(h=h||{})._=h._||{},y&&(h._["#"]=y);var u=h._[">"]||(h._[">"]={});return r!==l&&l!=="_"&&(typeof v=="number"&&(u[l]=v),r!==d&&(h[l]=d)),h},m.exports=t})(n,"./state"),n(function(m){n("./shim");function t(i){var e={s:{}},s=e.s;i=i||{max:999,age:1e3*9},e.check=function(r){return s[r]?f(r):!1};var f=e.track=function(r){var h=s[r]||(s[r]={});return h.was=e.now=+new Date,e.to||(e.to=setTimeout(e.drop,i.age+9)),h};return e.drop=function(r){e.to=null,e.now=+new Date;var h=Object.keys(s);console.STAT&&console.STAT(e.now,+new Date-e.now,"dup drop keys"),setTimeout.each(h,function(l){var v=s[l];v&&(r||i.age)>e.now-v.was||delete s[l]},0,99)},e}m.exports=t})(n,"./dup"),n(function(m){n("./onto"),m.exports=function(e,s){if(!!this.on){var f=(this.opt||{}).lack||9e3;if(typeof e!="function"){if(!e)return;var h=e["#"]||e,r=(this.tag||"")[h];return r?(s&&(r=this.on(h,s),clearTimeout(r.err),r.err=setTimeout(function(){r.off()},f)),!0):void 0}var h=s&&s["#"]||t(9);if(!e)return h;var l=this.on(h,e,s);return l.err=l.err||setTimeout(function(){l.off(),l.next({err:"Error: No ACK yet.",lack:!0})},f),h}};var t=String.random||function(){return Math.random().toString(36).slice(2)}})(n,"./ask"),n(function(m){function t(y){return y instanceof t?(this._={$:this}).$:this instanceof t?t.create(this._={$:this,opt:y}):new t(y)}t.is=function(y){return y instanceof t||y&&y._&&y===y._.$||!1},t.version=.202,t.chain=t.prototype,t.chain.toJSON=function(){},n("./shim"),t.valid=n("./valid"),t.state=n("./state"),t.on=n("./onto"),t.dup=n("./dup"),t.ask=n("./ask"),function(){t.create=function(k){k.root=k.root||k,k.graph=k.graph||{},k.on=k.on||t.on,k.ask=k.ask||t.ask,k.dup=k.dup||t.dup();var N=k.$.opt(k.opt);return k.once||(k.on("in",y,k),k.on("out",y,k),k.on("put",x,k),t.on("create",k),k.on("create",k)),k.once=1,N};function y(k){if(!!k){if(k.out===y){this.to.next(k);return}var N=this,p=N.as,w=p.at||p,S=w.$,E=w.dup,G,D=k.DBG;if((G=k["#"])||(G=k["#"]=e(9)),!E.check(G)){if(E.track(G),G=k._,k._=typeof G=="function"?G:function(){},k.$&&k.$===(k.$._||"").$||(k.$=S),k["@"]&&!k.put&&o(k),!w.ask(k["@"],k))if(D&&(D.u=+new Date),k.put){u(k);return}else k.get&&t.on.get(k,S);D&&(D.uc=+new Date),N.to.next(k),D&&(D.ua=+new Date),!(k.nts||k.NTS)&&(k.out=y,w.on("out",k),D&&(D.ue=+new Date))}}}function u(k){if(!!k){var N=k._||"",p=N.root=((N.$=k.$||"")._||"").root;if(k["@"]&&N.faith&&!N.miss){k.out=y,p.on("out",k);return}N.latch=p.hatch,N.match=p.hatch=[];var w=k.put,S=N.DBG=k.DBG,E=+new Date;if(!(w["#"]&&w["."])){S&&(S.p=E),N["#"]=k["#"],N.msg=k,N.all=0,N.stun=1;var G=Object.keys(w);console.STAT&&console.STAT(E,((S||N).pk=+new Date)-E,"put sort");var D=0,B,C,I,P,U,J,K;(function M(Y){if(B!=D){if(B=D,!(I=G[D])){console.STAT&&console.STAT(E,((S||N).pd=+new Date)-E,"put"),c(N);return}(P=w[I])?(K=P._)?I!==K["#"]?J=b+A(I)+"soul not same.":(U=K[">"])||(J=b+A(I)+"no state."):J=b+A(I)+"no meta.":J=b+A(I)+"no node.",C=Object.keys(P||{})}if(J){k.err=N.err=J,c(N);return}var ct=0,H;for(Y=Y||0;Y++<9&&(H=C[ct++]);)if(H!=="_"){var Q=P[H],lt=U[H];if(l===lt){J=b+A(H)+"on"+A(I)+"no state.";break}if(!f(Q)){J=b+A(H)+"on"+A(I)+"bad "+typeof Q+A(Q);break}_(Q,H,I,lt,k)}if((C=C.slice(ct)).length){s(M);return}++D,C=null,M(Y)})()}}}t.on.put=u;function _(k,N,p,w,S){var E=S._||"",G=E.root,D=G.graph,B,C=D[p]||v,I=r(C,N,1),P=C[N],U=E.DBG;(B=console.STAT)&&(!D[p]||!P)&&(B.has=(B.has||0)+1);var J=O();if(w>J){setTimeout(function(){_(k,N,p,w,S)},(B=w-J)>j?j:B),console.STAT&&console.STAT((U||E).Hf=+new Date,B,"future");return}if(!(w<I&&!E.miss)&&!(!E.faith&&w===I&&(k===P||$(k)<=$(P))&&!E.miss)){E.stun++;var K=S["#"]+E.all++,M={toString:function(){return K},_:E};M.toJSON=M.toString,U&&(U.ph=U.ph||+new Date),G.on("put",{"#":M,"@":S["@"],put:{"#":p,".":N,":":k,">":w},_:E})}}function x(k){var N;(N=(k._||"").DBG)&&(N.pa=+new Date,N.pm=N.pm||+new Date);var p=this,w=p.as,S=w.graph,E=k._,G=k.put,D=G["#"],B=G["."],C=G[":"],I=G[">"];k["#"];var P;(P=E.msg)&&(P=P.put)&&(P=P[D])&&h(P,B,I,C,D),S[D]=h(S[D],B,I,C,D),(P=(w.next||"")[D])&&P.on("in",k),c(E),p.to.next(k)}function c(k,N){var p;if(!k.stop&&!(!k.err&&0<--k.stun)&&(k.stop=1,!!(p=k.root))){var w=k.match;w.end=1,w===p.hatch&&(!(w=k.latch)||w.end?delete p.hatch:p.hatch=w),k.hatch&&k.hatch(),setTimeout.each(k.match,function(S){S&&S()}),!(!(N=k.msg)||k.err||N.err)&&(N.out=y,k.root.on("out",N))}}function o(k){var N=k["@"]||"",p;!(p=N._)||(p.acks=(p.acks||0)+1,(p.err=k.err)&&(k["@"]=p["#"],c(p)),!p.stop&&!p.crack&&(p.crack=p.match&&p.match.push(function(){a(p)})),a(p))}function a(k){!k||!k.root||k.stun||k.acks!==k.all||k.root.on("in",{"@":k["#"],err:k.err,ok:k.err?l:{"":1}})}var b="Error: Invalid graph!",A=function(k){return" '"+(""+k).slice(0,9)+"...' "},$=JSON.stringify,j=2147483647,O=t.state}(),function(){t.on.get=function(u,_){var x=_._,c=u.get,o=c["#"],a=x.graph[o],b=c["."],A=x.next||(x.next={});A[o];var $=u._||{},j=$.DBG=u.DBG;if(j&&(j.g=+new Date),!a)return x.on("get",u);if(b){if(typeof b!="string"||l===a[b])return x.on("get",u);a=h({},b,r(a,b),a[b],o)}a&&y(u,a),x.on("get",u)};function y(u,_){var x=+new Date,c=u._||{},o=c.DBG=u.DBG,a=u["#"],b=e(9),A=Object.keys(_||"").sort(),$=((_||"")._||"")["#"];A.length;var j=u.$._.root,O=_===j.graph[$];console.STAT&&console.STAT(x,((o||c).gk=+new Date)-x,"got keys"),_&&function k(){x=+new Date;for(var N=0,p,w={},S;N<9&&(p=A[N++]);)h(w,p,r(_,p),_[p],$);A=A.slice(N),(S={})[$]=w,w=S;var E;O&&(E=function(){},E.ram=E.faith=!0),S=A.length,console.STAT&&console.STAT(x,-(x-(x=+new Date)),"got copied some"),o&&(o.ga=+new Date),j.on("in",{"@":a,"#":b,put:w,"%":S?b=e(9):l,$:j.$,_:E,DBG:o}),console.STAT&&console.STAT(x,+new Date-x,"got in"),!!S&&setTimeout.turn(k)}(),_||j.on("in",{"@":u["#"]})}t.on.get.ack=y}(),function(){t.chain.opt=function(y){y=y||{};var u=this,_=u._,x=y.peers||y;return Object.plain(y)||(y={}),Object.plain(_.opt)||(_.opt=y),typeof x=="string"&&(x=[x]),x instanceof Array&&(Object.plain(_.opt.peers)||(_.opt.peers={}),x.forEach(function(c){var o={};o.id=o.url=c,_.opt.peers[c]=_.opt.peers[c]||o})),_.opt.peers=_.opt.peers||{},i(y,function c(o){var a=this[o];if(this&&this.hasOwnProperty(o)||typeof a=="string"||Object.empty(a)){this[o]=a;return}a&&a.constructor!==Object&&!(a instanceof Array)||i(a,c)}),t.on("opt",_),_.opt.uuid=_.opt.uuid||function(o){return t.state().toString(36).replace(".","")+String.random(o||12)},u}}();var i=function(y,u){Object.keys(y).forEach(u,y)},e=String.random,s=setTimeout.turn,f=t.valid,r=t.state.is,h=t.state.ify,l,v={},d;t.log=function(){return!t.log.off&&d.log.apply(d,arguments),[].slice.call(arguments).join(" ")},t.log.once=function(y,u,_){return(_=t.log.once)[y]=_[y]||0,_[y]++||t.log(u)},typeof window!="undefined"&&((window.GUN=window.Gun=t).window=window);try{typeof T!="undefined"&&(T.exports=t)}catch{}m.exports=t,(t.window||{}).console=(t.window||{}).console||{log:function(){}},(d=console).only=function(y,u){return d.only.i&&y===d.only.i&&d.only.i++&&(d.log.apply(d,arguments)||u)},t.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(n,"./root"),n(function(m){var t=n("./root");t.chain.back=function(s,f){var r;if(s=s||1,s===-1||s===1/0)return this._.root.$;if(s===1)return(this._.back||this._).$;var h=this,l=h._;if(typeof s=="string"&&(s=s.split(".")),s instanceof Array){var v=0,d=s.length,r=l;for(v;v<d;v++)r=(r||i)[s[v]];return e!==r?f?h:r:(r=l.back)?r.$.back(s,f):void 0}if(typeof s=="function"){for(var y,r={back:l};(r=r.back)&&e===(y=s(r,f)););return y}return typeof s=="number"?(l.back||l).$.back(s-1):this};var i={},e})(n,"./back"),n(function(m){var t=n("./root");t.chain.chain=function(c){var o=this,a=o._,b=new(c||o).constructor(o),A=b._,$;return A.root=$=a.root,A.id=++$.once,A.back=o._,A.on=t.on,A.on("in",t.on.in,A),A.on("out",t.on.out,A),b};function i(c){var o,a=this.as,b=a.back,A=a.root,$;if(c.$||(c.$=a.$),this.to.next(c),a.err){a.on("in",{put:a.put=l,$:a.$});return}if(o=c.get){if(A.pass&&(A.pass[a.id]=a),a.lex&&Object.keys(a.lex).forEach(function(j){$[j]=a.lex[j]},$=c.get=c.get||{}),o["#"]||a.soul){if(o["#"]=o["#"]||a.soul,c["#"]||(c["#"]=v(9)),b=A.$.get(o["#"])._,o=o["."]){if(y(b.put,o)&&($=b.ask&&b.ask[o],(b.ask||(b.ask={}))[o]=b.$.get(o)._,b.on("in",{get:o,put:{"#":b.soul,".":o,":":b.put[o],">":_(A.graph[b.soul],o)}}),$))return}else{if($=b.ask&&b.ask[""],(b.ask||(b.ask={}))[""]=b,l!==b.put&&(b.on("in",b),$))return;c.$=b.$}return A.ask(r,c),A.on("in",c)}if(o["."])return a.get?(c={get:{".":a.get},$:a.$},(b.ask||(b.ask={}))[a.get]=c.$._,b.on("out",c)):(c={get:a.lex?c.get:{},$:a.$},b.on("out",c));if((a.ask||(a.ask={}))[""]=a,a.get)return o["."]=a.get,(b.ask||(b.ask={}))[a.get]=c.$._,b.on("out",c)}return b.on("out",c)}t.on.out=i;function e(c,o){o=o||this.as;var a=o.root,b=c.$||(c.$=o.$),A=(b||"")._||h,$=c.put||"",j=$["#"],O=$["."],k=l!==$["="]?$["="]:$[":"],N=$[">"]||-1/0,p;if(l!==c.put&&(l===$["#"]||l===$["."]||l===$[":"]&&l===$["="]||l===$[">"])){if(!d($)){if(!(j=(($||"")._||"")["#"])){console.log("chain not yet supported for",$,"...",c,o);return}return b=o.root.$.get(j),setTimeout.each(Object.keys($).sort(),function(w){w=="_"||l===(N=_($,w))||o.on("in",{$:b,put:{"#":j,".":w,"=":$[w],">":N},VIA:c})})}o.on("in",{$:A.back.$,put:{"#":j=A.back.soul,".":O=A.has||A.get,"=":$,">":_(A.back.put,O)},via:c});return}(c.seen||"")[o.id]||((c.seen||(c.seen=function(){}))[o.id]=o,o!==A&&(Object.keys(c).forEach(function(w){$[w]=c[w]},$={}),$.get=o.get||$.get,!o.soul&&!o.has?$.$$$=$.$$$||o.$:A.soul&&($.$=o.$,$.$$=$.$$||A.$),c=$),f(c,o),(o.soul||c.$$)&&N>=_(a.graph[j],O)&&(($=a.$.get(j)._).put=x($.put,O,N,k,j)),!A.soul&&N>=_(a.graph[j],O)&&(p=(a.$.get(j)._.next||"")[O])&&(p.put=k,typeof($=d(k))=="string"&&(p.put=a.$.get($)._.put||k)),this.to&&this.to.next(c),o.any&&setTimeout.each(Object.keys(o.any),function(w){(w=o.any[w])&&w(c)},0,99),o.echo&&setTimeout.each(Object.keys(o.echo),function(w){(w=o.echo[w])&&w.on("in",c)},0,99),((c.$$||"")._||A).soul&&(p=o.next)&&(p=p[O])&&($={},Object.keys(c).forEach(function(w){$[w]=c[w]}),$.$=(c.$$||c.$).get($.get=O),delete $.$$,delete $.$$$,p.on("in",$)),s(c,o))}t.on.in=e;function s(c,o){if(o=o||this.as||c.$._,!(c.$$&&this!==t.on)&&!(!c.put||o.soul)){var a=c.put||"",b=a["="]||a[":"],A,$=o.root,j=$.$.get(a["#"]).get(a["."])._;if(typeof(b=d(b))!="string"){this===t.on&&((j.echo||(j.echo={}))[o.id]=o);return}if(!((j.echo||(j.echo={}))[o.id]&&!($.pass||"")[o.id])){if(A=$.pass){if(A[b+o.id])return;A[b+o.id]=1}(j.echo||(j.echo={}))[o.id]=o,o.has&&(o.link=b);var O=$.$.get(j.link=b)._;(O.echo||(O.echo={}))[j.id]=j;var A=o.ask||"";(A[""]||o.lex)&&O.on("out",{get:{"#":b}}),setTimeout.each(Object.keys(A),function(k,N){!k||!(N=A[k])||N.on("out",{get:{"#":b,".":k}})},0,99)}}}t.on.link=s;function f(c,o){var a=c.put||"",b=l!==a["="]?a["="]:a[":"],A=o.root,$,j;if(l===b){if(o.soul&&l!==o.put||(j=(c.$$||c.$||"")._||"",c["@"]&&(l!==j.put||l!==o.put)))return;($=o.link||c.linked)&&delete(A.$.get($)._.echo||"")[o.id],o.has&&(o.link=null),o.put=l,setTimeout.each(Object.keys(o.next||""),function(O,k){!(k=o.next[O])||($&&delete(A.$.get($).get(O)._.echo||"")[k.id],k.on("in",{get:O,put:l,$:k.$}))},0,99);return}o.soul||c.$$||($=d(b),j=c.$._||"",!(($===j.link||o.has&&!j.link)&&!((A.pass||"")[o.id]&&typeof $!="string"))&&(delete(j.echo||"")[o.id],f({get:o.get,put:l,$:c.$,linked:c.linked=c.linked||j.link},o)))}t.on.unlink=f;function r(c,o){var a=this.as,b=a.$._;b.root;var A=a.get||"",$=(c.put||"")[A["#"]]||"";if(!c.put||typeof A["."]=="string"&&l===$[A["."]]){if(l!==b.put||!b.soul&&!b.has)return;b.ack=(b.ack||0)+1,b.on("in",{get:b.get,put:b.put=l,$:b.$,"@":c["@"]});return}(c._||{}).miss=1,t.on.put(c)}var h={},l,v=String.random,d=t.valid,y=function(c,o){return c&&Object.prototype.hasOwnProperty.call(c,o)},u=t.state,_=u.is,x=u.ify})(n,"./chain"),n(function(m){var t=n("./root");t.chain.get=function(l,v,d){var y,u;if(typeof l=="string"){if(l.length==0)return(y=this.chain())._.err={err:t.log("0 length key!",l)},v&&v.call(y,y._.err),y;var _=this,x=_._,c=x.next||f;(y=c[l])||(y=l&&i(l,_)),y=y&&y.$}else if(typeof l=="function"){let j=function(O,k,N){if(!j.stun&&!((D=a.pass)&&!D[b])){var p=O.$._,w=(O.$$||"")._,S=(w||p).put,E=!p.has&&!p.soul,G={},D;if((E||h===S)&&(S=h===((D=O.put)||"")["="]?h===(D||"")[":"]?D:D[":"]:D["="]),typeof(D=t.valid(S))=="string"&&(S=h===(D=a.$.get(D)._.put)?o.not?h:S:D),!(o.not&&h===S)){if(h===o.stun){if((D=a.stun)&&D.on&&(x.$.back(function(B){if(D.on(""+B.id,G={}),(G.run||0)<j.id)return G}),!G.run&&D.on(""+p.id,G={}),!G.run&&w&&D.on(""+w.id,G={}),j.id>G.run&&((!G.stun||G.stun.end)&&(G.stun=D.on("stun"),G.stun=G.stun&&G.stun.last),G.stun&&!G.stun.end))){(G.stun.add||(G.stun.add={}))[b]=function(){j(O,k,1)};return}if(h===S&&(N=0),(D=a.hatch)&&!D.end&&h===o.hatch&&!N){if(A[p.$._.id])return;A[p.$._.id]=1,D.push(function(){j(O,k,1)});return}A={}}if(a.pass){if(a.pass[b+p.id])return;a.pass[b+p.id]=1}if(o.on){o.ok.call(p.$,S,p.get,O,k||j);return}if(o.v2020){o.ok(O,k||j);return}Object.keys(O).forEach(function(B){D[B]=O[B]},D={}),O=D,O.put=S,o.ok.call(o.as,O,k||j)}}};if(v===!0)return e(this,l,v,d),this;y=this;var x=y._,o=v||{},a=x.root,b;o.at=x,o.ok=l;var A={};return j.at=x,(x.any||(x.any={}))[b=String.random(7)]=j,j.off=function(){j.stun=1,!!x.any&&delete x.any[b]},j.rid=s,j.id=o.run||++a.once,u=a.pass,(a.pass={})[b]=1,o.out=o.out||{get:{}},x.on("out",o.out),a.pass=u,y}else{if(typeof l=="number")return this.get(""+l,v,d);if(typeof(u=r(l))=="string")return this.get(u,v,d);(u=this.get.next)&&(y=u(this,l))}return y?(v&&typeof v=="function"&&y.get(v,d),y):((y=this.chain())._.err={err:t.log("Invalid get request!",l)},v&&v.call(y,y._.err),y)};function i(l,v){var d=v._,y=d.next,u=v.chain(),_=u._;return y||(y=d.next={}),y[_.get=l]=_,v===d.root.$?_.soul=l:(d.soul||d.has)&&(_.has=l),_}function e(l,v,d,y){var u=l._,_=0,x;return(x=u.soul||u.link)?v(x,y,u):u.jam?u.jam.push([v,y]):(u.jam=[[v,y]],l.get(function(o,a){if(!(h===o.put&&!u.root.opt.super&&(x=Object.keys(u.root.opt.peers).length)&&++_<=x)){a.rid(o);var b=(b=o.$)&&b._||{},A=0,$;for(x=u.jam,delete u.jam;$=x[A++];){var j=$[0];$=$[1],j&&j(b.link||b.soul||t.valid(o.put)||((o.put||{})._||{})["#"],$,o,a)}}},{out:{get:{".":!0}}}),l)}function s(l){var v=this.at||this.on;if(!l||v.soul||v.has)return this.off();if(!!(l=(l=(l=l.$||l)._||l).id)){v.map;var d;if((d=this.seen||(this.seen={}))[l])return!0;d[l]=!0}}var f={},r=t.valid,h})(n,"./get"),n(function(m){var t=n("./root");t.chain.put=function(d,y,u){var _=this,x=_._,c=x.root;u=u||{},u.root=x.root,u.run||(u.run=c.once),i(u,x.id),u.ack=u.ack||y,u.via=u.via||_,u.data=u.data||d,u.soul||(u.soul=x.soul||typeof y=="string"&&y);var o=u.state=u.state||t.state();return typeof d=="function"?(d(function(a){u.data=a,_.put(f,f,u)}),_):u.soul?(u.$=c.$.get(u.soul),u.todo=[{it:u.data,ref:u.$}],u.turn=u.turn||h,u.ran=u.ran||e,function a(){var b=u.todo,A=b.pop(),$=A.it;A.ref&&A.ref._.id;var j,O,k,N,p;if(i(u,A.ref),(N=A.todo)&&(O=N.pop(),$=$[O],N.length&&b.push(A)),O&&(b.path||(b.path=[])).push(O),!(j=l($))&&!(p=t.is($))){if(!Object.plain($)){(u.ack||r).call(u,u.out={err:u.err=t.log("Invalid data: "+($&&(N=$.constructor)&&N.name||typeof $)+" at "+(u.via.back(function(G){G.get&&N.push(G.get)},N=[])||N.join("."))+"."+(b.path||[]).join("."))}),u.ran(u);return}for(var w=u.seen||(u.seen=[]),S=w.length;S--;)if($===(N=w[S]).it){j=$=N.link;break}}if(O&&j)A.node=v(A.node,O,o,$);else{let G=function(D,B){var C=k.link["#"];B&&(B.off(),B.rid(D));var I=C||D.soul||(N=(D.$$||D.$)._||"").soul||N.link||((N=N.put||"")._||"")["#"]||N["#"]||((N=D.put||"")&&D.$$?N["#"]:(N["="]||N[":"]||"")["#"]);if(!C&&i(u,D.$),!I&&!A.link["#"]){(A.wait||(A.wait=[])).push(function(){G(D,B)});return}I||(I=[],(D.$$||D.$).back(function(P){if(N=P.soul||P.link)return I.push(N);I.push(P.get)}),I=I.reverse().join("/")),k.link["#"]=I,!p&&(((u.graph||(u.graph={}))[I]=k.node||(k.node={_:{}}))._["#"]=I),delete u.wait[E],k.wait&&setTimeout.each(k.wait,function(P){P&&P()}),u.ran(u)};u.seen.push(k={it:$,link:{},todo:p?[]:Object.keys($).sort().reverse(),path:(b.path||[]).slice(),up:A}),A.node=v(A.node,O,o,k.link),!p&&k.todo.length&&b.push(k);var E=u.seen.length;(u.wait||(u.wait={}))[E]="",N=(k.ref=p?$:O?A.ref.get(O):A.ref)._,(N=$&&($._||"")["#"]||N.soul||N.link)?G({soul:N}):k.ref.get(G,{run:u.run,v2020:1,out:{get:{".":" "}}})}if(!b.length)return u.ran(u);u.turn(a)}(),_):(s(u),_)};function i(d,y){if(!!y){y=(y._||"").id||y;var u=d.root.stun||(d.root.stun={on:t.on}),_={},x;d.stun||(d.stun=u.on("stun",function(){})),(x=u.on(""+y))&&x.the.last.next(_),!(_.run>=d.run)&&u.on(""+y,function(c){if(d.stun.end){this.off(),this.to.next(c);return}c.run=c.run||d.run,c.stun=c.stun||d.stun})}}function e(d){if(d.err){e.end(d.stun,d.root);return}if(!(d.todo.length||d.end||!Object.empty(d.wait))){d.end=1;var y=d.$.back(-1)._,u=y.root,_=y.ask(function(a){u.on("ack",a),a.err&&t.log(a),++x>(d.acks||0)&&this.off(),!!d.ack&&d.ack(a,this)},d.opt),x=0,c=d.stun,o;(o=function(){!c||(e.end(c,u),setTimeout.each(Object.keys(c=c.add||""),function(a){(a=c[a])&&a()}))}).hatch=o,d.via._.on("out",{put:d.out=d.graph,opt:d.opt,"#":_,_:o})}}e.end=function(d,y){d.end=r,d.the.to===d&&d===d.the.last&&delete y.stun,d.off()};function s(d){var y=d.via._,u;d.via=d.via.back(function(_){if(_.soul||!_.get)return _.$;u=d.data,(d.data={})[_.get]=u}),(!d.via||!d.via._.soul)&&(d.via=y.root.$.get(((d.data||"")._||"")["#"]||y.$.back("opt.uuid")())),d.via.put(d.data,d.ack,d)}var f,r=function(){},h=setTimeout.turn,l=t.valid,v=t.state.ify})(n,"./put"),n(function(m){var t=n("./root");n("./chain"),n("./back"),n("./put"),n("./get"),m.exports=t})(n,"./index"),n(function(m){var t=n("./index");t.chain.on=function(s,f,r,h){var l=this,v=l._;v.root;var d;if(typeof s=="string")return f?(d=v.on(s,f,r||v,h),r&&r.$&&(r.subs||(r.subs=[])).push(d),l):v.on(s);var y=f;return(y=y===!0?{change:!0}:y||{}).not=1,y.on=1,l.get(s,y),l},t.chain.once=function(s,f){if(f=f||{},!s)return i(this);var r=this,h=r._,l=h.root;h.put;var v=String.random(7),d;return r.get(function(y,u,_,x){var c=this,o=c._,a=o.one||(o.one={});if(x.stun||a[v]==="")return;if((d=t.valid(y))===!0){b();return}if(typeof d=="string")return;clearTimeout((h.one||"")[v]),clearTimeout(a[v]),a[v]=setTimeout(b,f.wait||99);function b(){!o.has&&!o.soul&&(o={put:y,get:u}),e===(d=o.put)&&(d=((_.$$||"")._||"").put),!(typeof t.valid(d)=="string"&&(d=l.$.get(d)._.put,d===e))&&(x.stun||a[v]!==""&&(a[v]="",(h.soul||h.has)&&x.off(),s.call(c,d,o.get)))}},{on:1}),r};function i(s,f,r){return t.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(r=s.chain())._.nix=s.once(function(h,l){r._.on("in",this._)}),r._.lex=s._.lex,r}t.chain.off=function(){var s=this,f=s._,r,h=f.back;if(!!h)return f.ack=0,(r=h.next)&&r[f.get]&&delete r[f.get],(r=h.ask)&&delete r[f.get],(r=h.put)&&delete r[f.get],(r=f.soul)&&delete h.root.graph[r],(r=f.map)&&Object.keys(r).forEach(function(l,v){v=r[l],v.link&&h.root.$.get(v.link).off()}),(r=f.next)&&Object.keys(r).forEach(function(l,v){v=r[l],v.$.off()}),f.on("off",{}),s};var e})(n,"./on"),n(function(m){var t=n("./index"),i=t.chain.get.next;t.chain.get.next=function(r,h){var l;return Object.plain(h)?(l=((l=h["#"])||"")["="]||l)?r.get(l):((l=r.chain()._).lex=h,r.on("in",function(v){String.match(v.get||(v.put||"")["."],h["."]||h["#"]||h)&&l.on("in",v),this.to.next(v)}),l.$):(i||s)(r,h)},t.chain.map=function(r,h,l){var v=this,d=v._,y,u;return Object.plain(r)&&(y=r["."]?r:{".":r},r=f),r?(t.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),u=v.chain(),v.map().on(function(_,x,c,o){var a=(r||s).call(this,_,x,c,o);if(f!==a){if(_===a)return u._.on("in",c);if(t.is(a))return u._.on("in",a._);var b={};Object.keys(c.put).forEach(function(A){b[A]=c.put[A]},b),b["="]=a,u._.on("in",{get:x,put:b})}}),u):((u=d.each)||((d.each=u=v.chain())._.lex=y||u._.lex||d.lex,u._.nix=v.back("nix"),v.on("in",e,u._)),u)};function e(r){this.to.next(r);var h=this.as,l=r.$,v=l._,d=r.put,y;!v.soul&&!r.$$||(y=h.lex)&&!String.match(r.get||(d||"")["."],y["."]||y["#"]||y)||t.on.link(r,h)}var s=function(){},f})(n,"./map"),n(function(m){var t=n("./index");t.chain.set=function(i,e,s){var f=this,r=f.back(-1),h,l;return e=e||function(){},s=s||{},s.item=s.item||i,(h=((i||"")._||"")["#"])&&((i={})["#"]=h),typeof(l=t.valid(i))=="string"?f.get(h=l).put(i,e,s):t.is(i)?(f.put(function(v){i.get(function(d,y,u){if(!d)return e.call(f,{err:t.log('Only a node can be linked! Not "'+u.put+'"!')});(l={})[d]={"#":d},v(l)},!0)}),i):(Object.plain(i)&&(i=r.get(h=f.back("opt.uuid")()).put(i)),f.get(h||r.back("opt.uuid")(7)).put(i,e,s))}})(n,"./set"),n(function(m){n("./shim");function t(e){var s=function(){},f=e.opt||{};f.log=f.log||console.log,f.gap=f.gap||f.wait||0,f.max=f.max||(f.memory?f.memory*999*999:3e8)*.3,f.pack=f.pack||f.max*.01*.01,f.puff=f.puff||9;var r=setTimeout.turn||setTimeout,h=JSON.parseAsync||function(o,a,b){var A;try{a(A,JSON.parse(o,b))}catch($){a($)}},l=JSON.stringifyAsync||function(o,a,b,A){var $;try{a($,JSON.stringify(o,b,A))}catch(j){a(j)}},v=e.dup,d=v.check,y=v.track,u=s.hear=function(o,a){if(!!o){if(f.max<=o.length)return s.say({dam:"!",err:"Message too big!"},a);s===this&&(u.d+=o.length||0,++u.c);var b=a.SH=+new Date,A=o[0],$;if(A==="["){h(o,function(j,O){if(j||!O)return s.say({dam:"!",err:"DAM JSON parse error."},a);console.STAT&&console.STAT(+new Date,O.length,"# on hear batch");var k=f.puff;(function N(){for(var p=+new Date,w=0,S;w<k&&(S=O[w++]);)u(S,a);O=O.slice(w),console.STAT&&console.STAT(p,+new Date-p,"hear loop"),_(a),!!O.length&&r(N,0)})()}),o="";return}if(A==="{"||(o["#"]||Object.plain(o))&&($=o)){if($)return u.one($,a,b);h(o,function(j,O){if(j||!O)return s.say({dam:"!",err:"DAM JSON parse error."},a);u.one(O,a,b)});return}}};u.one=function(o,a,b){var A,$,j,O,k;if(o.DBG&&(o.DBG=k={DBG:o.DBG}),k&&(k.h=b),k&&(k.hp=+new Date),(A=o["#"])||(A=o["#"]=String.random(9)),!(j=d(A))&&($=o["##"],!($&&(j=o["@"]||o.get&&A)&&v.check(O=j+$)))){if((o._=function(){}).via=s.leap=a,(j=o["><"])&&typeof j=="string"&&j.slice(0,99).split(",").forEach(function(N){this[N]=1},o._.yo={}),j=o.dam){(j=s.hear[j])&&j(o,a,e),y(A);return}var b=+new Date;k&&(k.is=b),a.SI=A,e.on("in",s.last=o),k&&(k.hd=+new Date),console.STAT&&console.STAT(b,+new Date-b,o.get?"msg get":o.put?"msg put":"msg"),(j=y(A)).via=a,o.get&&(j.it=o),O&&y(O),s.leap=s.last=null}},u.c=u.d=0,function(){var o=0,a;s.hash=function(j,O){var k,N,p,w=+new Date;l(j.put,function S(E,G){var D=(N||(N=p=G||"")).slice(0,32768);if(k=String.hash(D,k),N=N.slice(32768),N){r(S,0);return}console.STAT&&console.STAT(w,+new Date-w,"say json+hash"),j._.$put=p,j["##"]=k,$(j,O),delete j._.$put},b)};function b(j,O){var k;return O instanceof Object?(Object.keys(O).sort().forEach(A,{to:k={},on:O}),k):O}function A(j){this.to[j]=this.on[j]}var $=s.say=function(j,O){var k;if((k=this)&&(k=k.to)&&k.next&&k.next(j),!j)return!1;var N,p,w=j["@"],S=j._||(j._=function(){}),E=j.DBG,G=+new Date;if(S.y=S.y||G,O||E&&(E.y=G),(N=j["#"])||(N=j["#"]=String.random(9)),!a&&y(N),j.put&&(j.err||(v.s[N]||"").err))return!1;if(!j["##"]&&i!==j.put&&!S.via&&w){s.hash(j,O);return}if(!O&&w&&(O=(k=v.s[w])&&(k.via||(k=k.it)&&(k=k._)&&k.via)||(k=s.last)&&w===k["#"]&&s.leap),!O&&w)return v.s[w]?void 0:(console.STAT&&console.STAT(+new Date,++o,"total no peer to ack to"),!1);if(!O&&s.way)return s.way(j);if(E&&(E.yh=+new Date),!(p=S.raw)){s.raw(j,O);return}if(E&&(E.yr=+new Date),!O||!O.id){if(!Object.plain(O||f.peers))return!1;var G=+new Date;f.puff;var D=f.peers,B=Object.keys(O||f.peers||{});console.STAT&&console.STAT(G,+new Date-G,"peer keys"),function P(){var U=+new Date;a=1;var J=S.raw;S.raw=p;for(var K=0,M;K<9&&(M=(B||"")[K++]);)!(M=D[M])||$(j,M);S.raw=J,a=0,B=B.slice(K),console.STAT&&console.STAT(U,+new Date-U,"say loop"),!!B.length&&(r(P,0),w&&y(w))}();return}if(!O.wire&&s.wire&&s.wire(O),N!==O.last){if(O.last=N,O===S.via||(k=S.yo)&&(k[O.url]||k[O.pid]||k[O.id]))return!1;if(console.STAT&&console.STAT(G,((E||S).yp=+new Date)-(S.y||G),"say prep"),!a&&w&&y(w),O.batch){if(O.tail=(k=O.tail||0)+p.length,O.tail<=f.pack){O.batch+=(k?",":"")+p;return}_(O)}O.batch="[";var C=+new Date;setTimeout(function(){console.STAT&&console.STAT(C,+new Date-C,"0ms TO"),_(O)},f.gap),x(p,O),console.STAT&&w===O.SI&&console.STAT(G,+new Date-O.SH,"say ack")}};s.say.c=s.say.d=0,s.raw=function(j,O){if(!j)return"";var k=j._||{},N,p;if(p=k.raw)return p;if(typeof j=="string")return j;var w=j["##"],S=j["@"];if(w&&S){if(!k.via&&d(S+w))return!1;if((p=(v.s[S]||"").it)||(p=s.last)&&S===p["#"]){if(w===p["##"])return!1;p["##"]||(p["##"]=w)}}if(!j.dam){var E=0,G=[];p=f.peers;for(var D in p){var B=p[D];if(G.push(B.url||B.pid||B.id),++E>6)break}E>1&&(j["><"]=G.join())}if(N=k.$put){p={},Object.keys(j).forEach(function(I){p[I]=j[I]}),p.put=":])([:",l(p,function(I,P){if(!I){var U=+new Date;p=P.indexOf('"put":":])([:"'),C(i,P=P.slice(0,p+6)+N+P.slice(p+14)),console.STAT&&console.STAT(U,+new Date-U,"say slice")}});return}l(j,C);function C(I,P){I||(k.raw=P,$(j,O))}}}();function _(o){var a=o.batch,b=typeof a=="string";if(b&&(a+="]"),o.batch=o.tail=null,!!a&&!(b?3>a.length:!a.length)){if(!b)try{a=a.length===1?a[0]:JSON.stringify(a)}catch(A){return f.log("DAM JSON stringify error",A)}!a||x(a,o)}}function x(o,a){try{var b=a.wire;a.say?a.say(o):b.send&&b.send(o),s.say.d+=o.length||0,++s.say.c}catch{(a.queue=a.queue||[]).push(o)}}s.hi=function(o){var a=o.wire||{};o.id?f.peers[o.url||o.id]=o:(a=o.id=o.id||String.random(9),s.say({dam:"?",pid:e.opt.pid},f.peers[a]=o),delete v.s[o.last]),o.met=o.met||+new Date,a.hied||e.on(a.hied="hi",o),a=o.queue,o.queue=[],setTimeout.each(a||[],function(b){x(b,o)},0,9)},s.bye=function(o){e.on("bye",o);var a=+new Date;a=a-(o.met||a),s.bye.time=((s.bye.time||a)+a)/2},s.hear["!"]=function(o,a){f.log("Error:",o.err)},s.hear["?"]=function(o,a){o.pid&&(a.pid||(a.pid=o.pid),o["@"])||(s.say({dam:"?",pid:f.pid,"@":o["#"]},a),delete v.s[a.last])},e.on("create",function(o){o.opt.pid=o.opt.pid||String.random(9),this.to.next(o),o.on("out",s.say)}),e.on("bye",function(o,a){o=f.peers[o.id||o]||o,this.to.next(o),o.bye?o.bye():(a=o.wire)&&a.close&&a.close(),delete f.peers[o.id],o.wire=null});var c={};return e.on("bye",function(o,a){this.to.next(o),(a=console.STAT)&&(a.peers=(a.peers||0)-1),!!(a=o.url)&&(c[a]=!0,setTimeout(function(){delete c[a]},f.lack||9e3))}),e.on("hi",function(o,a){this.to.next(o),(a=console.STAT)&&(a.peers=(a.peers||0)+1),!(!(a=o.url)||!c[a])&&(delete c[a],!f.super&&setTimeout.each(Object.keys(e.next),function(b){e.next[b],a={},a[b]=e.graph[b],a=String.hash(a),s.say({"##":a,get:{"#":b}},o)}))}),s}var i;try{m.exports=t}catch{}})(n,"./mesh"),n(function(m){var t=n("../index");t.Mesh=n("./mesh"),t.on("opt",function(e){if(this.to.next(e),e.once)return;var s=e.opt;if(s.WebSocket===!1)return;var f=t.window||{},r=s.WebSocket||f.WebSocket||f.webkitWebSocket||f.mozWebSocket;if(!r)return;s.WebSocket=r;var h=s.mesh=s.mesh||t.Mesh(e);h.wire||s.wire,h.wire=s.wire=l;function l(u){try{if(!u||!u.url)return x&&x(u);var _=u.url.replace(/^http/,"ws"),x=u.wire=new s.WebSocket(_);return x.onclose=function(){s.mesh.bye(u),d(u)},x.onerror=function(c){d(u)},x.onopen=function(){s.mesh.hi(u)},x.onmessage=function(c){!c||s.mesh.hear(c.data||c,u)},x}catch{}}setTimeout(function(){!s.super&&e.on("out",{dam:"hi"})},1);var v=2*999;function d(u){clearTimeout(u.defer),!(y&&u.retry<=0)&&(u.retry=(u.retry||s.retry+1||60)-(-u.tried+(u.tried=+new Date)<v*4?1:0),u.defer=setTimeout(function _(){if(y&&y.hidden)return setTimeout(_,v);l(u)},v))}var y=""+i!=typeof document&&document});var i})(n,"./websocket"),n(function(m){if(typeof Gun!="undefined"){var t=function(){},i;try{i=(Gun.window||t).localStorage}catch{}i||(Gun.log("Warning: No localStorage exists to persist data to!"),i={setItem:function(e,s){this[e]=s},removeItem:function(e){delete this[e]},getItem:function(e){return this[e]}}),Gun.on("create",function e(s){this.to.next(s);var f=s.opt;s.graph;var r=[],h,l;if(f.localStorage===!1)return;f.prefix=f.file||"gun/";try{h=e[f.prefix]=e[f.prefix]||JSON.parse(i.getItem(f.prefix))||{}}catch{h=e[f.prefix]={}}s.on("get",function(d){this.to.next(d);var y=d.get,u,_,x,c;!y||!(u=y["#"])||(_=h[u]||c,_&&(x=y["."])&&!Object.plain(x)&&(_=Gun.state.ify({},x,Gun.state.is(_,x),_[x],u)),Gun.on.get.ack(d,_))}),s.on("put",function(d){this.to.next(d);var y=d.put,u=y["#"],_=y["."];h[u]=Gun.state.ify(h[u],_,y[">"],y[":"],u),d["@"]||r.push(d["#"]),!l&&(l=setTimeout(v,f.wait||1))});function v(){var d,y=r;clearTimeout(l),l=!1,r=[];try{i.setItem(f.prefix,JSON.stringify(h))}catch(u){Gun.log((d=u||"localStorage failure")+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),s.on("localStorage:error",{err:d,get:f.prefix,put:h})}!d&&!Object.empty(f.peers)||setTimeout.each(y,function(u){s.on("in",{"@":u,err:d,ok:0})})}})}})(n,"./localStorage")})(),function(){var n;if(""+n!=typeof Gun){var T=function(p){console.log("Warning! Deprecated internal utility will break in next version:",p)},m=Gun;m.fn=m.fn||{is:function(p){return T("fn"),!!p&&typeof p=="function"}},m.bi=m.bi||{is:function(p){return T("bi"),p instanceof Boolean||typeof p=="boolean"}},m.num=m.num||{is:function(p){return T("num"),!i(p)&&(p-parseFloat(p)+1>=0||p===1/0||p===-1/0)}},m.text=m.text||{is:function(p){return T("text"),typeof p=="string"}},m.text.ify=m.text.ify||function(p){return T("text.ify"),m.text.is(p)?p:typeof JSON!="undefined"?JSON.stringify(p):p&&p.toString?p.toString():p},m.text.random=m.text.random||function(p,w){T("text.random");var S="";for(p=p||24,w=w||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";p>0;)S+=w.charAt(Math.floor(Math.random()*w.length)),p--;return S},m.text.match=m.text.match||function(p,w){var S,E;return T("text.match"),typeof p!="string"?!1:(typeof w=="string"&&(w={"=":w}),w=w||{},S=w["="]||w["*"]||w[">"]||w["<"],p===S?!0:E!==w["="]?!1:(S=w["*"]||w[">"]||w["<"],p.slice(0,(S||"").length)===S?!0:E!==w["*"]?!1:E!==w[">"]&&E!==w["<"]?p>=w[">"]&&p<=w["<"]:E!==w[">"]&&p>=w[">"]||E!==w["<"]&&p<=w["<"]))},m.text.hash=m.text.hash||function(p,w){if(T("text.hash"),typeof p=="string"){if(w=w||0,!p.length)return w;for(var S=0,E=p.length,G;S<E;++S)G=p.charCodeAt(S),w=(w<<5)-w+G,w|=0;return w}},m.list=m.list||{is:function(p){return T("list"),p instanceof Array}},m.list.slit=m.list.slit||Array.prototype.slice,m.list.sort=m.list.sort||function(p){return T("list.sort"),function(w,S){return!w||!S?0:(w=w[p],S=S[p],w<S?-1:w>S?1:0)}},m.list.map=m.list.map||function(p,w,S){return T("list.map"),r(p,w,S)},m.list.index=1,m.obj=m.boj||{is:function(p){return T("obj"),p?p instanceof Object&&p.constructor===Object||Object.prototype.toString.call(p).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},m.obj.put=m.obj.put||function(p,w,S){return T("obj.put"),(p||{})[w]=S,p},m.obj.has=m.obj.has||function(p,w){return T("obj.has"),p&&Object.prototype.hasOwnProperty.call(p,w)},m.obj.del=m.obj.del||function(p,w){if(T("obj.del"),!!p)return p[w]=null,delete p[w],p},m.obj.as=m.obj.as||function(p,w,S,E){return T("obj.as"),p[w]=p[w]||(E===S?{}:S)},m.obj.ify=m.obj.ify||function(p){if(T("obj.ify"),s(p))return p;try{p=JSON.parse(p)}catch{p={}}return p},function(){var p;function w(S,E){f(this,E)&&p!==this[E]||(this[E]=S)}m.obj.to=m.obj.to||function(S,E){return T("obj.to"),E=E||{},r(S,w,E),E}}(),m.obj.copy=m.obj.copy||function(p){return T("obj.copy"),p&&JSON.parse(JSON.stringify(p))},function(){function p(w,S){var E=this.n,G;if(!(E&&(S===E||s(E)&&f(E,S)))&&G!==S)return!0}m.obj.empty=m.obj.empty||function(w,S){return T("obj.empty"),w?!r(w,p,{n:S}):!0}}(),function(){function p(E,G){if(arguments.length===2){p.r=p.r||{},p.r[E]=G;return}p.r=p.r||[],p.r.push(E)}var w=Object.keys,S;Object.keys=Object.keys||function(E){return S(E,function(G,D,B){B(D)})},m.obj.map=S=m.obj.map||function(E,G,D){T("obj.map");var B,C=0,I,P,U,J,K=typeof G=="function";if(p.r=B,w&&s(E)&&(U=w(E),J=!0),D=D||{},i(E)||U)for(I=(U||E).length;C<I;C++){var M=C+m.list.index;if(K){if(P=J?G.call(D,E[U[C]],U[C],p):G.call(D,E[C],M,p),P!==B)return P}else if(G===E[J?U[C]:C])return U?U[C]:M}else for(C in E)if(K){if(f(E,C)&&(P=D?G.call(D,E[C],C,p):G(E[C],C,p),P!==B))return P}else if(G===E[C])return C;return K?p.r:m.list.index?0:-1}}(),m.time=m.time||{},m.time.is=m.time.is||function(p){return T("time"),p?p instanceof Date:+new Date().getTime()};var t=m.fn.is,i=m.list.is,e=m.obj,s=e.is,f=e.has,r=e.map,h={};h.is=function(p){return T("val.is"),p===n?!1:p===null?!0:p===1/0?!1:y(p)||v(p)||d(p)?!0:h.link.is(p)||!1},h.link=h.rel={_:"#"},function(){h.link.is=function(w){if(T("val.link.is"),w&&w[l]&&!w._&&s(w)){var S={};if(r(w,p,S),S.id)return S.id}return!1};function p(w,S){var E=this;if(E.id)return E.id=!1;if(S==l&&y(w))E.id=w;else return E.id=!1}}(),h.link.ify=function(p){return T("val.link.ify"),u({},l,p)},m.obj.has._=".";var l=h.link._,n,v=m.bi.is,d=m.num.is,y=m.text.is,e=m.obj,s=e.is,u=e.put,r=e.map;m.val=m.val||h;var _={_:"_"};_.soul=function(p,w){return T("node.soul"),p&&p._&&p._[w||a]},_.soul.ify=function(p,w){return T("node.soul.ify"),w=typeof w=="string"?{soul:w}:w||{},p=p||{},p._=p._||{},p._[a]=w.soul||p._[a]||o(),p},_.soul._=h.link._,function(){_.is=function(w,S,E){T("node.is");var G;return s(w)&&(G=_.soul(w))?!r(w,p,{as:E,cb:S,s:G,n:w}):!1};function p(w,S){if(S!==_._){if(!h.is(w))return!0;this.cb&&this.cb.call(this.as,w,S,this.n,this.s)}}}(),function(){_.ify=function(w,S,E){return T("node.ify"),S?typeof S=="string"?S={soul:S}:typeof S=="function"&&(S={map:S}):S={},S.map&&(S.node=S.map.call(E,w,n,S.node||{})),(S.node=_.soul.ify(S.node||{},S))&&r(w,p,{o:S,as:E}),S.node};function p(w,S){var E=this.o,G,D;if(E.map){G=E.map.call(this.as,w,""+S,E.node),D===G?x(E.node,S):E.node&&(E.node[S]=G);return}h.is(w)&&(E.node[S]=w)}}();var e=m.obj,s=e.is,x=e.del,r=e.map,c=m.text,o=c.random,a=_.soul._,n;m.node=m.node||_;var b=m.state;b.lex=function(){return T("state.lex"),b().toString(36).replace(".","")},b.to=function(p,w,S){T("state.to");var E=(p||{})[w];return s(E)&&(E=A(E)),b.ify(S,w,b.is(p,w),E,_.soul(p))},function(){b.map=function(w,S,E){T("state.map");var G,D=s(D=w||S)?D:null;return w=t(w=w||S)?w:null,D&&!w?(S=d(S)?S:b(),D[O]=D[O]||{},r(D,p,{o:D,s:S}),D):(E=E||s(S)?S:G,S=d(S)?S:b(),function(B,C,I,P){if(!w)return p.call({o:I,s:S},B,C),B;w.call(E||this||{},B,C,I,P),!(f(I,C)&&G===I[C])&&p.call({o:I,s:S},B,C)})};function p(w,S){O!==S&&b.ify(this.o,S,this.s)}}();var e=m.obj;e.as;var f=e.has,s=e.is,r=e.map,A=e.copy,$=m.num,d=$.is,j=m.fn,t=j.is,O=_._,n,k={};(function(){k.is=function(S,E,G,D){return T("graph.is"),!S||!s(S)||N(S)?!1:!r(S,p,{cb:E,fn:G,as:D})};function p(S,E){if(!S||E!==_.soul(S)||!_.is(S,this.fn,this.as))return!0;!this.cb||(w.n=S,w.as=this.as,this.cb.call(w.as,S,E,w))}function w(S){S&&_.is(w.n,S,w.as)}})(),function(){k.ify=function(D,B,C){T("graph.ify");var I={path:[],obj:D};return B?typeof B=="string"?B={soul:B}:typeof B=="function"&&(B.map=B):B={},typeof C=="string"&&(B.soul=B.soul||C,C=n),B.soul&&(I.link=h.link.ify(B.soul)),B.shell=(C||{}).shell,B.graph=B.graph||{},B.seen=B.seen||[],B.as=B.as||C,p(B,I),B.root=I.node,B.graph};function p(D,B){var C;return(C=G(D,B))?C:(B.env=D,B.soul=S,_.ify(B.obj,w,B)&&(B.link=B.link||h.link.ify(_.soul(B.node)),B.obj!==D.shell&&(D.graph[h.link.is(B.link)]=B.node)),B)}function w(D,B,C){var I=this,P=I.env,U,J;if(_._===B&&f(D,h.link._))return C._;if(!!(U=E(D,B,C,I,P))){if(B||(I.node=I.node||C||{},f(D,_._)&&_.soul(D)&&(I.node._=A(D._)),I.node=_.soul.ify(I.node,h.link.is(I.link)),I.link=I.link||h.link.ify(_.soul(I.node))),(J=P.map)&&(J.call(P.as||{},D,B,C,I),f(C,B))){if(D=C[B],n===D){x(C,B);return}if(!(U=E(D,B,C,I,P)))return}if(!B)return I.node;if(U===!0)return D;if(J=p(P,{obj:D,path:I.path.concat(B)}),!!J.node)return J.link}}function S(D){var B=this,C=h.link.is(B.link),I=B.env.graph;B.link=B.link||h.link.ify(D),B.link[h.link._]=D,B.node&&B.node[_._]&&(B.node[_._][h.link._]=D),f(I,C)&&(I[D]=I[C],x(I,C))}function E(D,B,C,I,P){var U;if(h.is(D))return!0;if(s(D))return 1;if(U=P.invalid)return D=U.call(P.as||{},D,B,C),E(D,B,C,I,P);P.err="Invalid value at '"+I.path.concat(B).join(".")+"'!",m.list.is(D)&&(P.err+=" Use `.set(item)` instead of an Array.")}function G(D,B){for(var C=D.seen,I=C.length,P;I--;)if(P=C[I],B.obj===P.obj)return P;C.push(B)}}(),k.node=function(p){T("graph.node");var w=_.soul(p);if(!!w)return u({},w,p)},function(){k.to=function(w,S,E){if(T("graph.to"),!!w){var G={};return E=E||{seen:{}},r(w[S],p,{obj:G,graph:w,opt:E}),G}};function p(w,S){var E,G;if(_._===S){if(N(w,h.link._))return;this.obj[S]=A(w);return}if(!(E=h.link.is(w))){this.obj[S]=w;return}if(G=this.opt.seen[E]){this.obj[S]=G;return}this.obj[S]=this.opt.seen[E]=k.to(this.graph,E,this.opt)}}();var t=m.fn.is,e=m.obj,s=e.is,x=e.del,f=e.has,N=e.empty,u=e.put,r=e.map,A=e.copy,n;m.graph=m.graph||k}}()})(jt);var Ee=jt.exports,Zt={exports:{}};(function(g){(function(){function n(m,t){return t?At(m):m.slice?n[i(m)]:function(e,s){m(e={exports:{}}),n[i(s)]=e.exports};function i(e){return e.split("/").slice(-1).toString().replace(".js","")}}var T=g;n(function(m){typeof window!="undefined"&&(m.window=window);var t=m.window||m,i,e=t.SEA||{};(e.window=m.window)&&(e.window.SEA=e);try{i+""!=typeof T&&(T.exports=e)}catch{}m.exports=e})(n,"./root"),n(function(m){var t=n("./root");try{t.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(n,"./https"),n(function(m){var t;if(t+""==typeof btoa){if(t+""==typeof Buffer)try{st.Buffer=n("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}st.btoa=function(i){return Buffer.from(i,"binary").toString("base64")},st.atob=function(i){return Buffer.from(i,"base64").toString("binary")}}})(n,"./base64"),n(function(m){n("./base64");function t(){}Object.assign(t,{from:Array.from}),t.prototype=Object.create(Array.prototype),t.prototype.toString=function(i,e,s){i=i||"utf8",e=e||0;const f=this.length;if(i==="hex"){const r=new Uint8Array(this);return[...Array((s&&s+1||f)-e).keys()].map(h=>r[h+e].toString(16).padStart(2,"0")).join("")}if(i==="utf8")return Array.from({length:(s||f)-e},(r,h)=>String.fromCharCode(this[h+e])).join("");if(i==="base64")return btoa(this)},m.exports=t})(n,"./array"),n(function(m){n("./base64");var t=n("./array");function i(...e){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),i.from(...e)}i.prototype=Object.create(Array.prototype),Object.assign(i,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const e=arguments[0];let s;if(typeof e=="string"){const r=arguments[1]||"utf8";if(r==="hex"){const h=e.match(/([\da-fA-F]{2})/g).map(l=>parseInt(l,16));if(!h||!h.length)throw new TypeError("Invalid first argument for type 'hex'.");s=t.from(h)}else if(r==="utf8"||r==="binary"){const h=e.length,l=new Uint16Array(h);Array.from({length:h},(v,d)=>l[d]=e.charCodeAt(d)),s=t.from(l)}else if(r==="base64"){const h=atob(e),l=h.length,v=new Uint8Array(l);Array.from({length:l},(d,y)=>v[y]=h.charCodeAt(y)),s=t.from(v)}else r==="binary"?s=t.from(e):console.info("SafeBuffer.from unknown encoding: "+r);return s}if(e.byteLength,e.byteLength?e.byteLength:e.length){let r;return e instanceof ArrayBuffer&&(r=new Uint8Array(e)),t.from(r||e)}},alloc(e,s=0){return t.from(new Uint8Array(Array.from({length:e},()=>s)))},allocUnsafe(e){return t.from(new Uint8Array(Array.from({length:e})))},concat(e){if(!Array.isArray(e))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return t.from(e.reduce((s,f)=>s.concat(Array.from(f)),[]))}}),i.prototype.from=i.from,i.prototype.toString=t.prototype.toString,m.exports=i})(n,"./buffer"),n(function(m){const t=n("./root"),i={Buffer:n("./buffer")};var e={},s;if(JSON.parseAsync=JSON.parseAsync||function(r,h,l){var v;try{h(v,JSON.parse(r,l))}catch(d){h(d)}},JSON.stringifyAsync=JSON.stringifyAsync||function(r,h,l,v){var d;try{h(d,JSON.stringify(r,l,v))}catch(y){h(y)}},i.parse=function(r,h){return new Promise(function(l,v){JSON.parseAsync(r,function(d,y){d?v(d):l(y)},h)})},i.stringify=function(r,h,l){return new Promise(function(v,d){JSON.stringifyAsync(r,function(y,u){y?d(y):v(u)},h,l)})},t.window&&(i.crypto=window.crypto||window.msCrypto,i.subtle=(i.crypto||e).subtle||(i.crypto||e).webkitSubtle,i.TextEncoder=window.TextEncoder,i.TextDecoder=window.TextDecoder,i.random=r=>i.Buffer.from(i.crypto.getRandomValues(new Uint8Array(i.Buffer.alloc(r))))),!i.TextDecoder){const{TextEncoder:r,TextDecoder:h}=n((s+""==typeof T?".":"")+"./lib/text-encoding",1);i.TextDecoder=h,i.TextEncoder=r}if(!i.crypto)try{var f=n("crypto",1);Object.assign(i,{crypto:f,random:h=>i.Buffer.from(f.randomBytes(h))});const{Crypto:r}=n("@peculiar/webcrypto",1);i.ossl=i.subtle=new r({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}m.exports=i})(n,"./shim"),n(function(m){var t=n("./root"),i=n("./shim"),e={};e.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},e.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},e.ecdh={name:"ECDH",namedCurve:"P-256"},e.jwk=function(s,f){s=s.split(".");var r=s[0],h=s[1],l={kty:"EC",crv:"P-256",x:r,y:h,ext:!0};return l.key_ops=f?["sign"]:["verify"],f&&(l.d=f),l},e.keyToJwk=function(s){const r=s.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"");return{kty:"oct",k:r,ext:!1,alg:"A256GCM"}},e.recall={validity:12*60*60,hook:function(s){return s}},e.check=function(s){return typeof s=="string"&&s.slice(0,4)==="SEA{"},e.parse=async function(f){try{var r=typeof f=="string";return r&&f.slice(0,4)==="SEA{"&&(f=f.slice(3)),r?await i.parse(f):f}catch{}return f},t.opt=e,m.exports=e})(n,"./settings"),n(function(m){var t=n("./shim");m.exports=async function(i,e){var s=typeof i=="string"?i:await t.stringify(i),f=await t.subtle.digest({name:e||"SHA-256"},new t.TextEncoder().encode(s));return t.Buffer.from(f)}})(n,"./sha256"),n(function(m){const t=n("./shim"),i=t.subtle,e=t.ossl?t.ossl:i,s=f=>e.digest({name:"SHA-1"},new ArrayBuffer(f));m.exports=s})(n,"./sha1"),n(function(m){var t=n("./root"),i=n("./shim"),e=n("./settings"),s=n("./sha256"),f;t.work=t.work||(async(r,h,l,v)=>{try{var d=(h||{}).epub||h;if(v=v||{},d instanceof Function&&(l=d,d=f),r=typeof r=="string"?r:await i.stringify(r),(v.name||"").toLowerCase().slice(0,3)==="sha"){var y=i.Buffer.from(await s(r,v.name),"binary").toString(v.encode||"base64");if(l)try{l(y)}catch(c){console.log(c)}return y}d=d||i.random(9);var u=await(i.ossl||i.subtle).importKey("raw",new i.TextEncoder().encode(r),{name:v.name||"PBKDF2"},!1,["deriveBits"]),_=await(i.ossl||i.subtle).deriveBits({name:v.name||"PBKDF2",iterations:v.iterations||e.pbkdf2.iter,salt:new i.TextEncoder().encode(v.salt||d),hash:v.hash||e.pbkdf2.hash},u,v.length||e.pbkdf2.ks*8);r=i.random(r.length);var x=i.Buffer.from(_,"binary").toString(v.encode||"base64");if(l)try{l(x)}catch(c){console.log(c)}return x}catch(c){if(console.log(c),t.err=c,t.throw)throw c;l&&l();return}}),m.exports=t.work})(n,"./work"),n(function(m){var t=n("./root"),i=n("./shim");n("./settings"),t.name=t.name||(async(e,s)=>{try{if(e)try{e()}catch(f){console.log(f)}return}catch(f){if(console.log(f),t.err=f,t.throw)throw f;e&&e();return}}),t.pair=t.pair||(async(e,s)=>{try{var f=i.ossl||i.subtle,r=await i.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async v=>{var d={};d.priv=(await i.subtle.exportKey("jwk",v.privateKey)).d;var y=await i.subtle.exportKey("jwk",v.publicKey);return d.pub=y.x+"."+y.y,d});try{var h=await f.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async v=>{var d={};d.epriv=(await f.exportKey("jwk",v.privateKey)).d;var y=await f.exportKey("jwk",v.publicKey);return d.epub=y.x+"."+y.y,d})}catch(v){if(t.window)throw v;if(v=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw v}h=h||{};var l={pub:r.pub,priv:r.priv,epub:h.epub,epriv:h.epriv};if(e)try{e(l)}catch(v){console.log(v)}return l}catch(v){if(console.log(v),t.err=v,t.throw)throw v;e&&e();return}}),m.exports=t.pair})(n,"./pair"),n(function(m){var t=n("./root"),i=n("./shim"),e=n("./settings"),s=n("./sha256"),f;t.sign=t.sign||(async(r,h,l,v)=>{try{if(v=v||{},!(h||v).priv){if(!t.I)throw"No signing key.";h=await t.I(null,{what:r,how:"sign",why:v.why})}if(f===r)throw"`undefined` not allowed.";var d=await e.parse(r),y=v.check=v.check||d;if(t.verify&&(t.opt.check(y)||y&&y.s&&y.m)&&f!==await t.verify(y,h)){var a=await e.parse(y);if(v.raw||(a="SEA"+await i.stringify(a)),l)try{l(a)}catch(A){console.log(A)}return a}var u=h.pub,_=h.priv,x=e.jwk(u,_),c=await s(d),o=await(i.ossl||i.subtle).importKey("jwk",x,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(b=>(i.ossl||i.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},b,new Uint8Array(c))),a={m:d,s:i.Buffer.from(o,"binary").toString(v.encode||"base64")};if(v.raw||(a="SEA"+await i.stringify(a)),l)try{l(a)}catch(b){console.log(b)}return a}catch(b){if(console.log(b),t.err=b,t.throw)throw b;l&&l();return}}),m.exports=t.sign})(n,"./sign"),n(function(m){var t=n("./root"),i=n("./shim"),e=n("./settings"),s=n("./sha256"),f;t.verify=t.verify||(async(l,v,d,y)=>{try{var u=await e.parse(l);if(v===!1){var _=await e.parse(u.m);if(d)try{d(_)}catch(O){console.log(O)}return _}y=y||{};var x=v.pub||v,c=t.opt.slow_leak?await t.opt.slow_leak(x):await(i.ossl||i.subtle).importKey("jwk",e.jwk(x),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),o=await s(u.m),a,b,A,$;try{if(a=i.Buffer.from(u.s,y.encode||"base64"),b=new Uint8Array(a),A=await(i.ossl||i.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},c,b,new Uint8Array(o)),!A)throw"Signature did not match."}catch{if(t.opt.fallback)return await t.opt.fall_verify(l,v,d,y)}var j=A?await e.parse(u.m):f;if(d)try{d(j)}catch(O){console.log(O)}return j}catch(O){if(console.log(O),t.err=O,t.throw)throw O;d&&d();return}}),m.exports=t.verify;var r={};t.opt.slow_leak=l=>{if(r[l])return r[l];var v=e.jwk(l);return r[l]=(i.ossl||i.subtle).importKey("jwk",v,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),r[l]};var h=t.opt;t.opt.fall_verify=async function(l,v,d,y,u){if(u===t.opt.fallback)throw"Signature did not match";u=u||1;var _=l||"";l=t.opt.unpack(l)||l;var x=await e.parse(l),c=v.pub||v,o=await t.opt.slow_leak(c),a=u<=t.opt.fallback?i.Buffer.from(await i.subtle.digest({name:"SHA-256"},new i.TextEncoder().encode(await e.parse(x.m)))):await s(x.m),b,A,$;try{if(b=i.Buffer.from(x.s,y.encode||"base64"),A=new Uint8Array(b),$=await(i.ossl||i.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},o,A,new Uint8Array(a)),!$)throw"Signature did not match."}catch{try{b=i.Buffer.from(x.s,"utf8"),A=new Uint8Array(b),$=await(i.ossl||i.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},o,A,new Uint8Array(a))}catch{if(!$)throw"Signature did not match."}}var j=$?await e.parse(x.m):f;if(h.fall_soul=_["#"],h.fall_key=_["."],h.fall_val=l,h.fall_state=_[">"],d)try{d(j)}catch(O){console.log(O)}return j},t.opt.fallback=2})(n,"./verify"),n(function(m){var t=n("./shim"),i=n("./settings"),e=n("./sha256");const s=async(f,r,h)=>{const l=f+(r||t.random(8)).toString("utf8"),v=t.Buffer.from(await e(l),"binary"),d=i.keyToJwk(v);return await t.subtle.importKey("jwk",d,{name:"AES-GCM"},!1,["encrypt","decrypt"])};m.exports=s})(n,"./aeskey"),n(function(m){var t=n("./root"),i=n("./shim");n("./settings");var e=n("./aeskey"),s;t.encrypt=t.encrypt||(async(f,r,h,l)=>{try{l=l||{};var v=(r||l).epriv||r;if(s===f)throw"`undefined` not allowed.";if(!v){if(!t.I)throw"No encryption key.";r=await t.I(null,{what:f,how:"encrypt",why:l.why}),v=r.epriv||r}var d=typeof f=="string"?f:await i.stringify(f),y={s:i.random(9),iv:i.random(15)},u=await e(v,y.s,l).then(x=>i.subtle.encrypt({name:l.name||"AES-GCM",iv:new Uint8Array(y.iv)},x,new i.TextEncoder().encode(d))),_={ct:i.Buffer.from(u,"binary").toString(l.encode||"base64"),iv:y.iv.toString(l.encode||"base64"),s:y.s.toString(l.encode||"base64")};if(l.raw||(_="SEA"+await i.stringify(_)),h)try{h(_)}catch(x){console.log(x)}return _}catch(x){if(console.log(x),t.err=x,t.throw)throw x;h&&h();return}}),m.exports=t.encrypt})(n,"./encrypt"),n(function(m){var t=n("./root"),i=n("./shim"),e=n("./settings"),s=n("./aeskey");t.decrypt=t.decrypt||(async(f,r,h,l)=>{try{l=l||{};var v=(r||l).epriv||r;if(!v){if(!t.I)throw"No decryption key.";r=await t.I(null,{what:f,how:"decrypt",why:l.why}),v=r.epriv||r}var d=await e.parse(f),y,u,_;try{y=i.Buffer.from(d.s,l.encode||"base64"),u=i.Buffer.from(d.iv,l.encode||"base64"),_=i.Buffer.from(d.ct,l.encode||"base64");var x=await s(v,y,l).then(o=>i.subtle.decrypt({name:l.name||"AES-GCM",iv:new Uint8Array(u),tagLength:128},o,new Uint8Array(_)))}catch{if(l.encode==="utf8")throw"Could not decrypt";if(t.opt.fallback)return l.encode="utf8",await t.decrypt(f,r,h,l)}var c=await e.parse(new i.TextDecoder("utf8").decode(x));if(h)try{h(c)}catch(o){console.log(o)}return c}catch(o){if(console.log(o),t.err=o,t.throw)throw o;h&&h();return}}),m.exports=t.decrypt})(n,"./decrypt"),n(function(m){var t=n("./root"),i=n("./shim");n("./settings"),t.secret=t.secret||(async(s,f,r,h)=>{try{if(h=h||{},!f||!f.epriv||!f.epub){if(!t.I)throw"No secret mix.";f=await t.I(null,{what:s,how:"secret",why:h.why})}var l=s.epub||s,v=f.epub,d=f.epriv,y=i.ossl||i.subtle,u=e(l),_=Object.assign({public:await y.importKey(...u,!0,[])},{name:"ECDH",namedCurve:"P-256"}),x=e(v,d),c=await y.importKey(...x,!1,["deriveBits"]).then(async a=>{var b=await y.deriveBits(_,a,256),A=new Uint8Array(b),$=await y.importKey("raw",A,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return y.exportKey("jwk",$).then(({k:j})=>j)}),o=c;if(r)try{r(o)}catch(a){console.log(a)}return o}catch(a){if(console.log(a),t.err=a,t.throw)throw a;r&&r();return}});var e=(s,f)=>{var[r,h]=s.split("."),l=f?{d:f}:{};return["jwk",Object.assign(l,{x:r,y:h,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};m.exports=t.secret})(n,"./secret"),n(function(m){var t=n("./root");t.certify=t.certify||(async(i,e={},s,f,r={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),i=(()=>{var o=[];if(i){if((typeof i=="string"||Array.isArray(i))&&i.indexOf("*")>-1)return"*";if(typeof i=="string")return i;if(Array.isArray(i)){if(i.length===1&&i[0])return typeof i[0]=="object"&&i[0].pub?i[0].pub:typeof i[0]=="string"?i[0]:null;i.map(a=>{typeof a=="string"?o.push(a):typeof a=="object"&&a.pub&&o.push(a.pub)})}return typeof i=="object"&&i.pub?i.pub:o.length>0?o:null}})(),!i)return console.log("No certificant found.");const l=r.expiry&&(typeof r.expiry=="number"||typeof r.expiry=="string")?parseFloat(r.expiry):null,v=(e||{}).read?e.read:null,d=(e||{}).write?e.write:typeof e=="string"||Array.isArray(e)||e["+"]||e["#"]||e["."]||e["="]||e["*"]||e[">"]||e["<"]?e:null,y=(r||{}).block||(r||{}).blacklist||(r||{}).ban||{},u=y.read&&(typeof y.read=="string"||(y.read||{})["#"])?y.read:null,_=typeof y=="string"?y:y.write&&(typeof y.write=="string"||y.write["#"])?y.write:null;if(!v&&!d)return console.log("No policy found.");const x=JSON.stringify(q(q(q(q(q({c:i},l?{e:l}:{}),v?{r:v}:{}),d?{w:d}:{}),u?{rb:u}:{}),_?{wb:_}:{}));var h=await t.sign(x,s,null,{raw:1});if(r.raw||(h="SEA"+JSON.stringify(h)),f)try{f(h)}catch(o){console.log(o)}return h}catch(l){if(t.err=l,t.throw)throw l;f&&f();return}}),m.exports=t.certify})(n,"./certify"),n(function(m){var t=n("./shim"),i=n("./root");i.work=n("./work"),i.sign=n("./sign"),i.verify=n("./verify"),i.encrypt=n("./encrypt"),i.decrypt=n("./decrypt"),i.certify=n("./certify"),i.random=i.random||t.random,i.Buffer=i.Buffer||n("./buffer"),i.keyid=i.keyid||(async e=>{try{const s=t.Buffer.concat(e.replace(/-/g,"+").replace(/_/g,"/").split(".").map(l=>t.Buffer.from(l,"base64"))),f=t.Buffer.concat([t.Buffer.from([153,s.length/256,s.length%256]),s]),r=await sha1hash(f),h=t.Buffer.from(r,"binary");return h.toString("hex",h.length-8)}catch(s){throw console.log(s),s}}),((i.window||{}).GUN||{}).SEA=i,m.exports=i})(n,"./sea"),n(function(m){var t=n("./sea"),i,e;t.window?i=t.window.GUN||{chain:{}}:i=n((e+""==typeof T?".":"")+"./gun",1),t.GUN=i;function s(r){this._={$:this}}s.prototype=function(){function r(){}return r.prototype=i.chain,new r}(),s.prototype.constructor=s,i.chain.user=function(r){var h=this,l=h.back(-1),v;if(r)return r=t.opt.pub((r._||"")["#"])||r,l.get("~"+r);if(v=l.back("user"))return v;var l=l._,d=l,y=d.opt.uuid||f;return(d=(v=d.user=h.chain(new s))._).opt={},d.opt.uuid=function(u){var _=y(),x=l.user;return!x||!(x=x.is)||!(x=x.pub)||(_="~"+x+"/"+_,u&&u.call&&u(null,_)),_},v};function f(){return i.state().toString(36).replace(".","")}i.User=s,s.GUN=i,s.SEA=i.SEA=t,m.exports=s})(n,"./user"),n(function(m){var t,i=""+t!=typeof window?window.Gun||{chain:{}}:n((""+t==typeof T?".":"")+"./gun",1);i.chain.then=function(e,s){var f=this,r=new Promise(function(h,l){f.once(h,s)});return e?r.then(e):r}})(n,"./then"),n(function(m){var t=n("./user"),i=t.SEA,e=t.GUN,s=function(){};t.prototype.create=function(...f){var r=typeof f[0]=="object"&&(f[0].pub||f[0].epub)?f[0]:typeof f[1]=="object"&&(f[1].pub||f[1].epub)?f[1]:null,h=r&&(r.pub||r.epub)?r.pub:typeof f[0]=="string"?f[0]:null,l=r&&(r.pub||r.epub)?r:h&&typeof f[1]=="string"?f[1]:null,v=f.filter(o=>typeof o=="function")[0]||null,d=f&&f.length>1&&typeof f[f.length-1]=="object"?f[f.length-1]:{},y=this,u=y._,_=y.back(-1);if(v=v||s,d=d||{},d.check!==!1){var x;if(h||(x="No user."),(l||"").length<8&&(x="Password too short!"),x)return v({err:e.log(x)}),y}if(u.ing)return(v||s)({err:e.log("User is already being created or authenticated!"),wait:!0}),y;u.ing=!0;var c={};return c.a=function(o){if(c.pubs=o,o&&!d.already){var a={err:e.log("User already created!")};u.ing=!1,(v||s)(a),y.leave();return}c.salt=String.random(64),i.work(l,c.salt,c.b)},c.b=function(o){c.proof=o,r?c.c(r):i.pair(c.c)},c.c=function(o){var a;c.pair=o||{},(a=u.root.user)&&(a._.sea=o,a.is={pub:o.pub,epub:o.epub,alias:h}),c.data={pub:o.pub},c.d()},c.d=function(){c.data.alias=h,c.e()},c.e=function(){c.data.epub=c.pair.epub,i.encrypt({priv:c.pair.priv,epriv:c.pair.epriv},c.proof,c.f,{raw:1})},c.f=function(o){c.data.auth=JSON.stringify({ek:o,s:c.salt}),c.g(c.data.auth)},c.g=function(o){var a;c.data.auth=c.data.auth||o,_.get(a="~"+c.pair.pub).put(c.data).on(c.h);var b={};b[a]={"#":a},_.get("~@"+h).put(b).get(a).on(c.i)},c.h=function(o,a,b,A){A.off(),c.h.ok=1,c.i()},c.i=function(o,a,b,A){A&&(c.i.ok=1,A.off()),!(!c.h.ok||!c.i.ok)&&(u.ing=!1,v({ok:0,pub:c.pair.pub}),s===v&&(r?y.auth(r):y.auth(h,l)))},_.get("~@"+h).once(c.a),y},t.prototype.leave=function(f,r){var h=this,l=h.back(-1)._.user;if(l&&(delete l.is,delete l._.is,delete l._.sea),i.window)try{var v={};v=window.sessionStorage,delete v.recall,delete v.pair}catch{}return h}})(n,"./create"),n(function(m){var t=n("./user"),i=t.SEA,e=t.GUN,s=function(){};t.prototype.auth=function(...r){var h=typeof r[0]=="object"&&(r[0].pub||r[0].epub)?r[0]:typeof r[1]=="object"&&(r[1].pub||r[1].epub)?r[1]:null,l=!h&&typeof r[0]=="string"?r[0]:null,v=l&&typeof r[1]=="string"?r[1]:null,d=r.filter(a=>typeof a=="function")[0]||null,y=r&&r.length>1&&typeof r[r.length-1]=="object"?r[r.length-1]:{},u=this,_=u._,x=u.back(-1);if(_.ing)return(d||s)({err:e.log("User is already being created or authenticated!"),wait:!0}),u;_.ing=!0;var c={},o;return c.a=function(a){if(!a)return c.b();if(!a.pub){var b=[];return Object.keys(a).forEach(function(A){A!="_"&&b.push(a[A])}),c.b(b)}if(c.name)return c.f(a);c.c((c.data=a).auth)},c.b=function(a){var b=(c.list=(c.list||[]).concat(a||[])).shift();if(o===b)return c.name?c.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer."):c.err("Wrong user or password.");x.get(b).once(c.a)},c.c=function(a){if(o===a)return c.b();if(typeof a=="string")return c.c(f(a));i.work(v,(c.auth=a).s,c.d,c.enc)},c.d=function(a){i.decrypt(c.auth.ek,a,c.e,c.enc)},c.e=function(a){if(o===a)return c.enc?(c.enc=null,c.b()):(c.enc={encode:"utf8"},c.c(c.auth));c.half=a,c.f(c.data)},c.f=function(a){var b=c.half||{},A=c.data||{};c.g(c.lol={pub:a.pub||A.pub,epub:a.epub||A.epub,priv:a.priv||b.priv,epriv:a.epriv||b.epriv})},c.g=function(a){if(!a||!a.pub||!a.epub)return c.b();c.pair=a;var b=x._.user,A=b._;A.tag;var $=A.opt;A=b._=x.get("~"+a.pub)._,A.opt=$,b.is={pub:a.pub,epub:a.epub,alias:l||a.pub},A.sea=c.pair,_.ing=!1;try{v&&o==(f(_.root.graph["~"+a.pub].auth)||"")[":"]&&(y.shuffle=y.change=v)}catch{}if(y.change?c.z():(d||s)(A),i.window&&(u.back("user")._.opt||y).remember)try{var j={};j=window.sessionStorage,j.recall=!0,j.pair=JSON.stringify(a)}catch{}try{x._.tag.auth?x._.on("auth",A):setTimeout(function(){x._.on("auth",A)},1)}catch(O){e.log("Your 'auth' callback crashed with:",O)}},c.z=function(){c.salt=String.random(64),i.work(y.change,c.salt,c.y)},c.y=function(a){i.encrypt({priv:c.pair.priv,epriv:c.pair.epriv},a,c.x,{raw:1})},c.x=function(a){c.w(JSON.stringify({ek:a,s:c.salt}))},c.w=function(a){if(y.shuffle){console.log("migrate core account from UTF8 & shuffle");var b={};Object.keys(c.data).forEach(function(A){b[A]=c.data[A]}),delete b._,b.auth=a,x.get("~"+c.pair.pub).put(b)}x.get("~"+c.pair.pub).get("auth").put(a,d||s)},c.err=function(a){var b={err:e.log(a||"User cannot be found!")};_.ing=!1,(d||s)(b)},c.plugin=function(a){if(!(c.name=a))return c.err();var b=[a];a[0]!=="~"&&(b[1]="~"+a,b[2]="~@"+a),c.b(b)},h?c.g(h):l?x.get("~@"+l).once(c.a):!l&&!v&&i.name(c.plugin),u};function f(r){if(typeof r!="string")return r;try{r=JSON.parse(r)}catch{r={}}return r}})(n,"./auth"),n(function(m){var t=n("./user"),i=t.SEA;t.GUN,t.prototype.recall=function(e,s){var f=this,r=f.back(-1);if(e=e||{},e&&e.sessionStorage){if(i.window)try{var h={};h=window.sessionStorage,h&&(r._.opt.remember=!0,(f.back("user")._.opt||e).remember=!0,(h.recall||h.pair)&&r.user().auth(JSON.parse(h.pair),s))}catch{}return f}return f}})(n,"./recall"),n(function(m){var t=n("./user"),i=t.SEA,e=t.GUN,s=function(){};t.prototype.pair=function(){var f=this,r;try{r=new Proxy({DANGER:"\u2620"},{get:function(h,l,v){if(!(!f.is||!(f._||"").sea))return f._.sea[l]}})}catch{}return r},t.prototype.delete=async function(f,r,h){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var l=this;l.back(-1);var v=l.back("user");try{v.auth(f,r,function(d){var y=(v.is||{}).pub;v.map().once(function(){this.put(null)}),v.leave(),(h||s)({ok:0})})}catch(d){e.log("User.delete failed! Error:",d)}return l},t.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const f=this.back(-1);try{return await authRecall(f),f._.user._}catch{const h="No session!";throw e.log(h),{err:h}}},t.prototype.trust=async function(f){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),e.is(f)&&f.get("pub").get((r,h)=>{console.log(r,h)}),f.get("trust").get(path).put(theirPubkey)},t.prototype.grant=function(f,r){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var h=this,l=h.back(-1).user(),v=l._.sea,d="";return h.back(function(y){y.is||(d+=y.get||"")}),async function(){var y,u=await l.get("grant").get(v.pub).get(d).then();u=await i.decrypt(u,v),u||(u=i.random(16).toString(),y=await i.encrypt(u,v),l.get("grant").get(v.pub).get(d).put(y));var _=f.get("pub").then(),x=f.get("epub").then();_=await _,x=await x;var c=await i.secret(x,v);y=await i.encrypt(u,c),l.get("grant").get(_).get(d).put(y,r)}(),h},t.prototype.secret=function(f,r){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var h=this,l=h.back(-1).user(),v=l.pair(),d="";return h.back(function(y){y.is||(d+=y.get||"")}),async function(){var y,u=await l.get("trust").get(v.pub).get(d).then();u=await i.decrypt(u,v),u||(u=i.random(16).toString(),y=await i.encrypt(u,v),l.get("trust").get(v.pub).get(d).put(y)),y=await i.encrypt(f,u),h.put(y,r)}(),h},m.exports=t})(n,"./share"),n(function(m){var t=n("./sea"),i=n("./settings"),e=function(){},s,f=""+s!=typeof window?window.Gun||{on:e}:n((""+s==typeof T?".":"")+"./gun",1);f.on("opt",function(u){u.sea||(u.sea={own:{}},u.on("put",r,u)),this.to.next(u)});function r(u){var _=this,x=_.as,c=u.put,o=c["#"],a=c["."],b=c[":"],A=c[">"],$=u["#"],j;if(!(!o||!a)){if((u._||"").faith&&(x.opt||"").faith&&typeof u._=="function"){t.opt.pack(c,function(k){t.verify(k,!1,function(N){c["="]=t.opt.unpack(N),_.to.next(u)})});return}var O=function(k){x.on("in",{"@":$,err:u.err=k})};if((u._||"").DBG&&((u._||"").DBG.c=+new Date),0<=o.indexOf("<?")&&(j=parseFloat(o.split("<?")[1]||""),j&&A<f.state()-j*1e3)){(j=u._)&&j.stun&&j.stun--;return}if(o==="~@"){r.alias(_,u,b,a,o,x,O);return}if(o.slice(0,2)==="~@"){r.pubs(_,u,b,a,o,x,O);return}if(j=t.opt.pub(o)){r.pub(_,u,b,a,o,x,O,x.user||"",j);return}if(0<=o.indexOf("#")){r.hash(_,u,b,a,o,x,O);return}r.any(_,u,b,a,o,x,O,x.user||"")}}r.hash=function(u,_,x,c,o,a,b){t.work(x,null,function(A){if(A&&A===c.split("#").slice(-1)[0])return u.to.next(_);b("Data hash not same as hash!")},{name:"SHA-256"})},r.alias=function(u,_,x,c,o,a,b){if(!x)return b("Data must exist!");if("~@"+c===l(x))return u.to.next(_);b("Alias not same!")},r.pubs=function(u,_,x,c,o,a,b){if(!x)return b("Alias must exist!");if(c===l(x))return u.to.next(_);b("Alias not same!")},r.pub=async function(u,_,x,c,o,a,b,A,$){var j;const O=await i.parse(x)||{},k=(N,p,w)=>{if(N.m&&N.s&&p&&$)return t.verify(N,$,S=>{if(s!==S&&s!==S.e&&_.put[">"]&&_.put[">"]>parseFloat(S.e))return b("Certificate expired.");if(s!==S&&S.c&&S.w&&(S.c===p||S.c.indexOf("*")>-1)){let G=o.indexOf("/")>-1?o.replace(o.substring(0,o.indexOf("/")+1),""):"";String.match=String.match||f.text.match;const D=Array.isArray(S.w)?S.w:typeof S.w=="object"||typeof S.w=="string"?[S.w]:[];for(const B of D)if(String.match(G,B["#"])&&String.match(c,B["."])||!B["."]&&String.match(G,B["#"])||!B["#"]&&String.match(c,B["."])||String.match(G?G+"/"+c:c,B["#"]||B)){if(B["+"]&&B["+"].indexOf("*")>-1&&G&&G.indexOf(p)==-1&&c.indexOf(p)==-1)return b(`Path "${G}" or key "${c}" must contain string "${p}".`);if(S.wb&&(typeof S.wb=="string"||(S.wb||{})["#"])){var E=u.as.root.$.back(-1);return typeof S.wb=="string"&&S.wb.slice(0,1)!=="~"&&(E=E.get("~"+$)),E.get(S.wb).get(p).once(C=>C&&(C===1||C===!0)?b(`Certificant ${p} blocked.`):w(S))}return w(S)}return b("Certificate verification fail.")}})};if(c==="pub"&&"~"+$===o)return x===$?u.to.next(_):b("Account not same!");if((j=A.is)&&j.pub&&!O["*"]&&!O["+"]&&($===j.pub||$!==j.pub&&((_._.msg||{}).opt||{}).cert)){t.opt.pack(_.put,N=>{t.sign(N,A._.sea,async function(p){if(s===p)return b(t.err||"Signature fail.");if(_.put[":"]={":":j=t.opt.unpack(p.m),"~":p.s},_.put["="]=j,$===A.is.pub){(j=l(x))&&((a.sea.own[j]=a.sea.own[j]||{})[$]=1),JSON.stringifyAsync(_.put[":"],function(w,S){return w?b(w||"Stringify error."):(_.put[":"]=S,u.to.next(_))});return}if($!==A.is.pub&&((_._.msg||{}).opt||{}).cert){const w=await i.parse(_._.msg.opt.cert);w&&w.m&&w.s&&k(w,A.is.pub,S=>{_.put[":"]["+"]=w,_.put[":"]["*"]=A.is.pub,JSON.stringifyAsync(_.put[":"],function(E,G){return E?b(E||"Stringify error."):(_.put[":"]=G,u.to.next(_))})})}},{raw:1})});return}t.opt.pack(_.put,N=>{t.verify(N,O["*"]||$,function(p){var w;if(p=t.opt.unpack(p),s===p)return b("Unverified data.");if((w=l(p))&&$===t.opt.pub(w)&&((a.sea.own[w]=a.sea.own[w]||{})[$]=1),O["+"]&&O["+"].m&&O["+"].s&&O["*"])k(O["+"],O["*"],S=>(_.put["="]=p,u.to.next(_)));else return _.put["="]=p,u.to.next(_)})})},r.any=function(u,_,x,c,o,a,b,A){if(a.opt.secure)return b("Soul missing public key at '"+c+"'.");a.on("secure",function($){if(this.off(),!a.opt.secure)return u.to.next($);b("Data cannot be changed.")}).on.on("secure",_)};var h=f.valid,l=function(u,_){return typeof(_=h(u))=="string"&&_};(f.state||"").ify;var v=/[^\w_-]/;t.opt.pub=function(u){if(!!u&&(u=u.split("~"),!(!u||!(u=u[1]))&&(u=u.split(v).slice(0,2),!(!u||u.length!=2)&&(u[0]||"")[0]!=="@")))return u=u.slice(0,2).join("."),u},t.opt.stringy=function(u){},t.opt.pack=function(u,_,x,c,o){var a,b;if(t.opt.check(u))return _(u);u&&u["#"]&&u["."]&&u[">"]&&(a=u[":"],b=1),JSON.parseAsync(b?a:u,function(A,$){var j=s!==($||"")[":"]&&($||"")["~"];if(!j){_(u);return}_({m:{"#":o||u["#"],".":x||u["."],":":($||"")[":"],">":u[">"]||f.state.is(c,x)},s:j})})};var d=t.opt;t.opt.unpack=function(u,_,x){var c;if(s!==u){if(u&&s!==(c=u[":"]))return c;if(_=_||d.fall_key,!x&&d.fall_val&&(x={},x[_]=d.fall_val),!(!_||!x)){if(u===x[_]||!t.opt.check(x[_]))return u;var o=x&&x._&&x._["#"]||d.fall_soul,a=f.state.is(x,_)||d.fall_state;if(u&&u.length===4&&o===u[0]&&_===u[1]&&y(a)===y(u[3]))return u[2];if(a<t.opt.shuffle_attack)return u}}},t.opt.shuffle_attack=15463296e5;var y=Math.floor})(n,"./index")})()})(Zt);export{zt as A,_e as B,ke as C,me as D,oe as E,xe as F,Vt as G,Yt as H,re as I,ye as J,le as K,Se as L,ge as M,Xt as N,je as S,fe as a,ae as b,he as c,de as d,ue as e,ie as f,Kt as g,Ht as h,Ae as i,be as j,yt as k,ce as l,ne as m,R as n,we as o,Te as p,$e as q,kt as r,Bt as s,ve as t,z as u,Ee as v,ee as w,se as x,_t as y,pe as z};
